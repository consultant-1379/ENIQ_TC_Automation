############################################## ENERGY REPORT ILs ##############################################

###############################################################################################################
Information Link Name:IL_DC_DATAVOLUME_DOD 
DECLARE @date DATE
SET @date = DATEADD(dd, -186, GETDATE())
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

DECLARE @nodes VARCHAR(50)
SET @nodes = ''
IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_NR_NRCELLDU_RAW') > 0 )
SET @nodes = @nodes + 'NR'
IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_ERBS_EUTRANCELLFDD_RAW') > 0 )
SET @nodes = @nodes + 'LTE'
IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_RAN_UCELL_RAW') > 0 )
SET @nodes = @nodes + 'WCDMA' 
IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_BSS_CELL_PS_RAW') > 0 )
SET @nodes = @nodes + 'GSM'

IF(@nodes LIKE 'NRLTEWCDMAGSM')
SELECT 
ENERGY_SUM."NODE" AS "ERBS",
D1."EUtrancellFDD" AS "EUtrancellFDD",
D1."OSS_ID" AS "OSS_ID",
D1."DATETIME_ID" AS "DATETIME_ID",
D1."DataVolumeDown" AS "DataVolumeDown",
D1."DataVolumeUp" AS "DataVolumeUp",
D1."NODE_TYPE" AS "NODETYPE"
FROM 
(
SELECT 
ENERGY_DAY."NODE",
ENERGY_DAY."NODETYPE",
RANK() OVER (PARTITION BY ENERGY_DAY."NODETYPE" ORDER BY ENERGY_DAY."PMCONSUMEDENERGYSUM" DESC) AS "ENERGYRANK"
FROM
(
SELECT
D1."ERBS" AS "NODE",
'4G' AS "NODETYPE",
SUM(D1."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D1
WHERE
D1."DATE_ID" >= @date AND D1."DATE_ID" < @dateDay 
AND D1."ROWSTATUS" = 'AGGREGATED' AND D1."ERBS" <> '' AND D1."ERBS" IS NOT NULL
GROUP BY D1."ERBS"
UNION 
SELECT
D2."RBS" AS "NODE",
'3G' AS "NODETYPE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."RBS" <> '' AND D2."RBS" IS NOT NULL
GROUP BY D2."RBS"
UNION
SELECT 
ENERGY_DAY_TCU."NODE",
ENERGY_NODES."NODETYPE",
ENERGY_DAY_TCU."PMCONSUMEDENERGYSUM"
FROM
(
SELECT
D2."NE_NAME" AS "NODE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."NE_NAME" <> '' AND D2."NE_NAME" IS NOT NULL
GROUP BY D2."NE_NAME"
)ENERGY_DAY_TCU,
(
SELECT 
D5."NR_NAME" AS "NODE",
'5G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_NR" D5

UNION
SELECT 
D5."ERBS_NAME" AS "NODE",
'4G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_ERBS" D5

UNION
SELECT
D6."RBS_NAME" AS "NODE",
'3G' AS "NODETYPE",
D6."OSS_ID" AS "OSSID"
FROM "DIM_E_RAN_RBS" D6

UNION
SELECT
D7."RADIONODE_NAME" AS "NODE",
'2G' AS "NODETYPE",
D7."OSS_ID" AS "OSSID"
FROM "DIM_E_GRAN_RADIONODE" D7

)ENERGY_NODES
WHERE ENERGY_NODES."NODE" = ENERGY_DAY_TCU."NODE"
)ENERGY_DAY
)ENERGY_SUM,
(
SELECT 
NR_Name as ERBS,
NRCellDu as EUtrancellFDD,
OSS_ID,
DATETIME_ID,
SUM(DataVolumeDown) AS DataVolumeDown,
SUM(DataVolumeUp) AS DataVolumeUp,
NODE_TYPE
FROM (
SELECT
NR_Name,
NRCellDu,
OSS_ID,
DATETIME_ID,
SUM(0.008*pmMacVolDl) AS DataVolumeDown,
SUM(0.008*pmMacVolUl) AS DataVolumeUp,
'5G' AS NODE_TYPE
FROM DC_E_NR_NRCELLDU_RAW
WHERE 
DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
GROUP BY NR_Name, NRCellDu, OSS_ID, DATETIME_ID, NODE_TYPE
) dataVolume5G
GROUP BY ERBS, EUtrancellFDD, OSS_ID, DATETIME_ID, NODE_TYPE
UNION
SELECT 
 ERBS, 
 EUtrancellFDD,
 OSS_ID, 
 DATETIME_ID, 
 SUM(pmPdcpVolDlDrb) AS DataVolumeDown, 
 SUM(pmPdcpVolUlDrb) AS DataVolumeUp, 
 '4G' AS NODE_TYPE
 FROM (
  SELECT 
   ERBS, 
   EUtrancellFDD AS EUtrancellFDD,
   OSS_ID, 
   DATETIME_ID, 
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLFDD_RAW 
   WHERE DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
  UNION ALL
  SELECT 
   ERBS, 
   EUtrancellTDD AS EUtrancellFDD, 
   OSS_ID, 
   DATETIME_ID, 
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLTDD_RAW 
   WHERE DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
) pmPdcpVol 
GROUP BY ERBS, EUtrancellFDD, OSS_ID, DATETIME_ID
UNION
SELECT 
 dim_rbs.RBS_NAME AS ERBS, 
 dim_ucell.UCELL_NAME AS EUtrancellFDD, 
 ran.OSS_ID, 
 ran.DATETIME_ID, 
 SUM(
   pmDlTrafficVolumeAmr4750 
 + pmDlTrafficVolumeAmr5900 
 + pmDlTrafficVolumeAmr7950 
 + pmDlTrafficVolumeAmrNbMm 
 + pmDlTrafficVolumeAmrWb 
 + pmDlTrafficVolumeCs12 
 + pmDlTrafficVolumeCs57 
 + pmDlTrafficVolumeCs64 
 + pmDlTrafficVolumePs128 
 + pmDlTrafficVolumePs16 
 + pmDlTrafficVolumePs384 
 + pmDlTrafficVolumePs64 
 + pmDlTrafficVolumePs8 
 + pmDlTrafficVolumePsCommon 
 + pmDlTrafficVolumePsIntHs 
 + pmDlTrafficVolumePsStr128 
 + pmDlTrafficVolumePsStr16 
 + pmDlTrafficVolumePsStr64 
 + pmDlTrafficVolumePsStrHs 
 + pmDlTrafficVolumeSrb136 
 + pmDlTrafficVolumeSrb34 
 + pmDlTrafficVolumeSrbOnlyHs
 )AS DataVolumeDown, 
  SUM(
   pmUlTrafficVolumeAmr4750 
 + pmUlTrafficVolumeAmr5900 
 + pmUlTrafficVolumeAmr7950 
 + pmUlTrafficVolumeAmrNbMm 
 + pmUlTrafficVolumeAmrWb 
 + pmUlTrafficVolumeCs12 
 + pmUlTrafficVolumeCs57 
 + pmUlTrafficVolumeCs64 
 + pmUlTrafficVolumePs128 
 + pmUlTrafficVolumePs16 
 + pmUlTrafficVolumePs384 
 + pmUlTrafficVolumePs64 
 + pmUlTrafficVolumePs8 
 + pmUlTrafficVolumePsCommon 
 + pmUlTrafficVolumePsIntEul 
 + pmUlTrafficVolumePsIntEulFach 
 + pmUlTrafficVolumePsStr128 
 + pmUlTrafficVolumePsStr16 
 + pmUlTrafficVolumePsStr32 
 + pmUlTrafficVolumeSrb136 
 + pmUlTrafficVolumeSrb34 
 + pmUlTrafficVolumeSrbOnlyEul
) AS DataVolumeUp, 
'3G' AS NODE_TYPE
FROM DC_E_RAN_UCELL_RAW ran
INNER JOIN DIM_E_RAN_RBS dim_rbs ON dim_rbs.AssociatedRncName = ran.RNC
INNER JOIN DIM_E_RAN_UCELL dim_ucell ON dim_ucell.UCELL_NAME = ran.UtranCell AND dim_ucell.RBS_ID = dim_rbs.RBS_NAME
WHERE ran.DATETIME_ID >= @date AND ran.DATETIME_ID < @dateDay
GROUP BY ERBS, EUtrancellFDD, ran.OSS_ID, ran.DATETIME_ID
UNION
SELECT 
rn.RADIONODE_NAME AS ERBS,
CELL_NAME AS EUtrancellFDD,
D4.OSS_ID,
D4.DATETIME_ID,
SUM(
CELLGPRS3_DLSTRVOL + 
CELLGPRS3_DLINTBGVOL) as DataVolumeDown,
SUM(
CELLQOSS_VOLULSTRACC + 
CELLGPRS3_ULINTBGVOL + 
CELLEIT2_LLCVOLULEIT + 
CLDTMQOS_DTMULSTRDATA) as DataVolumeUp,
'2G' AS NODE_TYPE
FROM
DC_E_BSS_CELL_PS_RAW D4
INNER JOIN DIM_E_GRAN_RADIONODE_TRX trx ON D4.CELL_NAME = trx.GSMSECTOR
INNER JOIN DIM_E_GRAN_RADIONODE rn ON trx.RADIONODE = rn.RADIONODE_NAME
WHERE D4.DATETIME_ID >= @date AND D4.DATETIME_ID < @dateDay 
GROUP BY ERBS, EUtrancellFDD, D4.OSS_ID, D4.DATETIME_ID
)D1
WHERE ENERGY_SUM."ENERGYRANK" <= 100
AND ENERGY_SUM."NODE" = D1."ERBS"
AND <conditions>


ELSE IF(@nodes LIKE 'NRLTEWCDMA')
SELECT 
ENERGY_SUM."NODE" AS "ERBS",
D1."EUtrancellFDD" AS "EUtrancellFDD",
D1."OSS_ID" AS "OSS_ID",
D1."DATETIME_ID" AS "DATETIME_ID",
D1."DataVolumeDown" AS "DataVolumeDown",
D1."DataVolumeUp" AS "DataVolumeUp",
D1."NODE_TYPE" AS "NODETYPE"
FROM 
(
SELECT 
ENERGY_DAY."NODE",
ENERGY_DAY."NODETYPE",
RANK() OVER (PARTITION BY ENERGY_DAY."NODETYPE" ORDER BY ENERGY_DAY."PMCONSUMEDENERGYSUM" DESC) AS "ENERGYRANK"
FROM
(
SELECT
D1."ERBS" AS "NODE",
'4G' AS "NODETYPE",
SUM(D1."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D1
WHERE
D1."DATE_ID" >= @date AND D1."DATE_ID" < @dateDay 
AND D1."ROWSTATUS" = 'AGGREGATED' AND D1."ERBS" <> '' AND D1."ERBS" IS NOT NULL
GROUP BY D1."ERBS"
UNION 
SELECT
D2."RBS" AS "NODE",
'3G' AS "NODETYPE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."RBS" <> '' AND D2."RBS" IS NOT NULL
GROUP BY D2."RBS"
UNION
SELECT 
ENERGY_DAY_TCU."NODE",
ENERGY_NODES."NODETYPE",
ENERGY_DAY_TCU."PMCONSUMEDENERGYSUM"
FROM
(
SELECT
D2."NE_NAME" AS "NODE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."NE_NAME" <> '' AND D2."NE_NAME" IS NOT NULL
GROUP BY D2."NE_NAME"
)ENERGY_DAY_TCU,
(
SELECT 
D5."NR_NAME" AS "NODE",
'5G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_NR" D5

UNION
SELECT 
D5."ERBS_NAME" AS "NODE",
'4G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_ERBS" D5

UNION
SELECT
D6."RBS_NAME" AS "NODE",
'3G' AS "NODETYPE",
D6."OSS_ID" AS "OSSID"
FROM "DIM_E_RAN_RBS" D6

)ENERGY_NODES
WHERE ENERGY_NODES."NODE" = ENERGY_DAY_TCU."NODE"
)ENERGY_DAY
)ENERGY_SUM,
(
SELECT 
NR_Name as ERBS,
NRCellDu as EUtrancellFDD,
OSS_ID,
DATETIME_ID,
SUM(DataVolumeDown) AS DataVolumeDown,
SUM(DataVolumeUp) AS DataVolumeUp,
NODE_TYPE
FROM (
SELECT
NR_Name,
NRCellDu,
OSS_ID,
DATETIME_ID,
SUM(0.008*pmMacVolDl) AS DataVolumeDown,
SUM(0.008*pmMacVolUl) AS DataVolumeUp,
'5G' AS NODE_TYPE
FROM DC_E_NR_NRCELLDU_RAW
WHERE 
DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
GROUP BY NR_Name, NRCellDu, OSS_ID, DATETIME_ID, NODE_TYPE
) dataVolume5G
GROUP BY ERBS, EUtrancellFDD, OSS_ID, DATETIME_ID, NODE_TYPE
UNION
SELECT 
 ERBS, 
 EUtrancellFDD,
 OSS_ID, 
 DATETIME_ID, 
 SUM(pmPdcpVolDlDrb) AS DataVolumeDown, 
 SUM(pmPdcpVolUlDrb) AS DataVolumeUp, 
 '4G' AS NODE_TYPE
 FROM (
  SELECT 
   ERBS, 
   EUtrancellFDD AS EUtrancellFDD,
   OSS_ID, 
   DATETIME_ID, 
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLFDD_RAW 
   WHERE DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
  UNION ALL
  SELECT 
   ERBS, 
   EUtrancellTDD AS EUtrancellFDD, 
   OSS_ID, 
   DATETIME_ID, 
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLTDD_RAW 
   WHERE DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
) pmPdcpVol 
GROUP BY ERBS, EUtrancellFDD, OSS_ID, DATETIME_ID
UNION
SELECT 
 dim_rbs.RBS_NAME AS ERBS, 
 dim_ucell.UCELL_NAME AS EUtrancellFDD, 
 ran.OSS_ID, 
 ran.DATETIME_ID, 
 SUM(
   pmDlTrafficVolumeAmr4750 
 + pmDlTrafficVolumeAmr5900 
 + pmDlTrafficVolumeAmr7950 
 + pmDlTrafficVolumeAmrNbMm 
 + pmDlTrafficVolumeAmrWb 
 + pmDlTrafficVolumeCs12 
 + pmDlTrafficVolumeCs57 
 + pmDlTrafficVolumeCs64 
 + pmDlTrafficVolumePs128 
 + pmDlTrafficVolumePs16 
 + pmDlTrafficVolumePs384 
 + pmDlTrafficVolumePs64 
 + pmDlTrafficVolumePs8 
 + pmDlTrafficVolumePsCommon 
 + pmDlTrafficVolumePsIntHs 
 + pmDlTrafficVolumePsStr128 
 + pmDlTrafficVolumePsStr16 
 + pmDlTrafficVolumePsStr64 
 + pmDlTrafficVolumePsStrHs 
 + pmDlTrafficVolumeSrb136 
 + pmDlTrafficVolumeSrb34 
 + pmDlTrafficVolumeSrbOnlyHs
 )AS DataVolumeDown, 
  SUM(
   pmUlTrafficVolumeAmr4750 
 + pmUlTrafficVolumeAmr5900 
 + pmUlTrafficVolumeAmr7950 
 + pmUlTrafficVolumeAmrNbMm 
 + pmUlTrafficVolumeAmrWb 
 + pmUlTrafficVolumeCs12 
 + pmUlTrafficVolumeCs57 
 + pmUlTrafficVolumeCs64 
 + pmUlTrafficVolumePs128 
 + pmUlTrafficVolumePs16 
 + pmUlTrafficVolumePs384 
 + pmUlTrafficVolumePs64 
 + pmUlTrafficVolumePs8 
 + pmUlTrafficVolumePsCommon 
 + pmUlTrafficVolumePsIntEul 
 + pmUlTrafficVolumePsIntEulFach 
 + pmUlTrafficVolumePsStr128 
 + pmUlTrafficVolumePsStr16 
 + pmUlTrafficVolumePsStr32 
 + pmUlTrafficVolumeSrb136 
 + pmUlTrafficVolumeSrb34 
 + pmUlTrafficVolumeSrbOnlyEul
) AS DataVolumeUp, 
'3G' AS NODE_TYPE
FROM DC_E_RAN_UCELL_RAW ran
INNER JOIN DIM_E_RAN_RBS dim_rbs ON dim_rbs.AssociatedRncName = ran.RNC
INNER JOIN DIM_E_RAN_UCELL dim_ucell ON dim_ucell.UCELL_NAME = ran.UtranCell AND dim_ucell.RBS_ID = dim_rbs.RBS_NAME
WHERE ran.DATETIME_ID >= @date AND ran.DATETIME_ID < @dateDay
GROUP BY ERBS, EUtrancellFDD, ran.OSS_ID, ran.DATETIME_ID
)D1
WHERE ENERGY_SUM."ENERGYRANK" <= 100
AND ENERGY_SUM."NODE" = D1."ERBS"
AND <conditions>



ELSE IF(@nodes LIKE 'NRLTEGSM')
SELECT 
ENERGY_SUM."NODE" AS "ERBS",
D1."EUtrancellFDD" AS "EUtrancellFDD",
D1."OSS_ID" AS "OSS_ID",
D1."DATETIME_ID" AS "DATETIME_ID",
D1."DataVolumeDown" AS "DataVolumeDown",
D1."DataVolumeUp" AS "DataVolumeUp",
D1."NODE_TYPE" AS "NODETYPE"
FROM 
(
SELECT 
ENERGY_DAY."NODE",
ENERGY_DAY."NODETYPE",
RANK() OVER (PARTITION BY ENERGY_DAY."NODETYPE" ORDER BY ENERGY_DAY."PMCONSUMEDENERGYSUM" DESC) AS "ENERGYRANK"
FROM
(
SELECT
D1."ERBS" AS "NODE",
'4G' AS "NODETYPE",
SUM(D1."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D1
WHERE
D1."DATE_ID" >= @date AND D1."DATE_ID" < @dateDay 
AND D1."ROWSTATUS" = 'AGGREGATED' AND D1."ERBS" <> '' AND D1."ERBS" IS NOT NULL
GROUP BY D1."ERBS"
UNION 
SELECT
D2."RBS" AS "NODE",
'3G' AS "NODETYPE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."RBS" <> '' AND D2."RBS" IS NOT NULL
GROUP BY D2."RBS"
UNION
SELECT 
ENERGY_DAY_TCU."NODE",
ENERGY_NODES."NODETYPE",
ENERGY_DAY_TCU."PMCONSUMEDENERGYSUM"
FROM
(
SELECT
D2."NE_NAME" AS "NODE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."NE_NAME" <> '' AND D2."NE_NAME" IS NOT NULL
GROUP BY D2."NE_NAME"
)ENERGY_DAY_TCU,
(
SELECT 
D5."NR_NAME" AS "NODE",
'5G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_NR" D5

UNION
SELECT 
D5."ERBS_NAME" AS "NODE",
'4G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_ERBS" D5

UNION
SELECT
D7."RADIONODE_NAME" AS "NODE",
'2G' AS "NODETYPE",
D7."OSS_ID" AS "OSSID"
FROM "DIM_E_GRAN_RADIONODE" D7

)ENERGY_NODES
WHERE ENERGY_NODES."NODE" = ENERGY_DAY_TCU."NODE"
)ENERGY_DAY
)ENERGY_SUM,
(
SELECT 
NR_Name as ERBS,
NRCellDu as EUtrancellFDD,
OSS_ID,
DATETIME_ID,
SUM(DataVolumeDown) AS DataVolumeDown,
SUM(DataVolumeUp) AS DataVolumeUp,
NODE_TYPE
FROM (
SELECT
NR_Name,
NRCellDu,
OSS_ID,
DATETIME_ID,
SUM(0.008*pmMacVolDl) AS DataVolumeDown,
SUM(0.008*pmMacVolUl) AS DataVolumeUp,
'5G' AS NODE_TYPE
FROM DC_E_NR_NRCELLDU_RAW
WHERE 
DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
GROUP BY NR_Name, NRCellDu, OSS_ID, DATETIME_ID, NODE_TYPE
) dataVolume5G
GROUP BY ERBS, EUtrancellFDD, OSS_ID, DATETIME_ID, NODE_TYPE
UNION
SELECT 
 ERBS, 
 EUtrancellFDD,
 OSS_ID, 
 DATETIME_ID, 
 SUM(pmPdcpVolDlDrb) AS DataVolumeDown, 
 SUM(pmPdcpVolUlDrb) AS DataVolumeUp, 
 '4G' AS NODE_TYPE
 FROM (
  SELECT 
   ERBS, 
   EUtrancellFDD AS EUtrancellFDD,
   OSS_ID, 
   DATETIME_ID, 
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLFDD_RAW 
   WHERE DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
  UNION ALL
  SELECT 
   ERBS, 
   EUtrancellTDD AS EUtrancellFDD, 
   OSS_ID, 
   DATETIME_ID, 
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLTDD_RAW 
   WHERE DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
) pmPdcpVol 
GROUP BY ERBS, EUtrancellFDD, OSS_ID, DATETIME_ID
UNION
SELECT 
rn.RADIONODE_NAME AS ERBS,
CELL_NAME AS EUtrancellFDD,
D4.OSS_ID,
D4.DATETIME_ID,
SUM(
CELLGPRS3_DLSTRVOL + 
CELLGPRS3_DLINTBGVOL) as DataVolumeDown,
SUM(
CELLQOSS_VOLULSTRACC + 
CELLGPRS3_ULINTBGVOL + 
CELLEIT2_LLCVOLULEIT + 
CLDTMQOS_DTMULSTRDATA) as DataVolumeUp,
'2G' AS NODE_TYPE
FROM
DC_E_BSS_CELL_PS_RAW D4
INNER JOIN DIM_E_GRAN_RADIONODE_TRX trx ON D4.CELL_NAME = trx.GSMSECTOR
INNER JOIN DIM_E_GRAN_RADIONODE rn ON trx.RADIONODE = rn.RADIONODE_NAME
WHERE D4.DATETIME_ID >= @date AND D4.DATETIME_ID < @dateDay 
GROUP BY ERBS, EUtrancellFDD, D4.OSS_ID, D4.DATETIME_ID
)D1
WHERE ENERGY_SUM."ENERGYRANK" <= 100
AND ENERGY_SUM."NODE" = D1."ERBS"
AND <conditions>



ELSE IF(@nodes LIKE 'NRLTE')
SELECT 
ENERGY_SUM."NODE" AS "ERBS",
D1."EUtrancellFDD" AS "EUtrancellFDD",
D1."OSS_ID" AS "OSS_ID",
D1."DATETIME_ID" AS "DATETIME_ID",
D1."DataVolumeDown" AS "DataVolumeDown",
D1."DataVolumeUp" AS "DataVolumeUp",
D1."NODE_TYPE" AS "NODETYPE"
FROM 
(
SELECT 
ENERGY_DAY."NODE",
ENERGY_DAY."NODETYPE",
RANK() OVER (PARTITION BY ENERGY_DAY."NODETYPE" ORDER BY ENERGY_DAY."PMCONSUMEDENERGYSUM" DESC) AS "ENERGYRANK"
FROM
(
SELECT
D1."ERBS" AS "NODE",
'4G' AS "NODETYPE",
SUM(D1."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D1
WHERE
D1."DATE_ID" >= @date AND D1."DATE_ID" < @dateDay 
AND D1."ROWSTATUS" = 'AGGREGATED' AND D1."ERBS" <> '' AND D1."ERBS" IS NOT NULL
GROUP BY D1."ERBS"
UNION 
SELECT
D2."RBS" AS "NODE",
'3G' AS "NODETYPE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."RBS" <> '' AND D2."RBS" IS NOT NULL
GROUP BY D2."RBS"
UNION
SELECT 
ENERGY_DAY_TCU."NODE",
ENERGY_NODES."NODETYPE",
ENERGY_DAY_TCU."PMCONSUMEDENERGYSUM"
FROM
(
SELECT
D2."NE_NAME" AS "NODE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."NE_NAME" <> '' AND D2."NE_NAME" IS NOT NULL
GROUP BY D2."NE_NAME"
)ENERGY_DAY_TCU,
(
SELECT 
D5."NR_NAME" AS "NODE",
'5G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_NR" D5

UNION
SELECT 
D5."ERBS_NAME" AS "NODE",
'4G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_ERBS" D5

)ENERGY_NODES
WHERE ENERGY_NODES."NODE" = ENERGY_DAY_TCU."NODE"
)ENERGY_DAY
)ENERGY_SUM,
(
SELECT 
NR_Name as ERBS,
NRCellDu as EUtrancellFDD,
OSS_ID,
DATETIME_ID,
SUM(DataVolumeDown) AS DataVolumeDown,
SUM(DataVolumeUp) AS DataVolumeUp,
NODE_TYPE
FROM (
SELECT
NR_Name,
NRCellDu,
OSS_ID,
DATETIME_ID,
SUM(0.008*pmMacVolDl) AS DataVolumeDown,
SUM(0.008*pmMacVolUl) AS DataVolumeUp,
'5G' AS NODE_TYPE
FROM DC_E_NR_NRCELLDU_RAW
WHERE 
DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
GROUP BY NR_Name, NRCellDu, OSS_ID, DATETIME_ID, NODE_TYPE
) dataVolume5G
GROUP BY ERBS, EUtrancellFDD, OSS_ID, DATETIME_ID, NODE_TYPE
UNION
SELECT 
 ERBS, 
 EUtrancellFDD,
 OSS_ID, 
 DATETIME_ID, 
 SUM(pmPdcpVolDlDrb) AS DataVolumeDown, 
 SUM(pmPdcpVolUlDrb) AS DataVolumeUp, 
 '4G' AS NODE_TYPE
 FROM (
  SELECT 
   ERBS, 
   EUtrancellFDD AS EUtrancellFDD,
   OSS_ID, 
   DATETIME_ID, 
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLFDD_RAW 
   WHERE DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
  UNION ALL
  SELECT 
   ERBS, 
   EUtrancellTDD AS EUtrancellFDD, 
   OSS_ID, 
   DATETIME_ID, 
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLTDD_RAW 
   WHERE DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
) pmPdcpVol 
GROUP BY ERBS, EUtrancellFDD, OSS_ID, DATETIME_ID
)D1
WHERE ENERGY_SUM."ENERGYRANK" <= 100
AND ENERGY_SUM."NODE" = D1."ERBS"
AND <conditions>



ELSE IF(@nodes LIKE 'LTEWCDMAGSM')
SELECT 
ENERGY_SUM."NODE" AS "ERBS",
D1."EUtrancellFDD" AS "EUtrancellFDD",
D1."OSS_ID" AS "OSS_ID",
D1."DATETIME_ID" AS "DATETIME_ID",
D1."DataVolumeDown" AS "DataVolumeDown",
D1."DataVolumeUp" AS "DataVolumeUp",
D1."NODE_TYPE" AS "NODETYPE"
FROM 
(
SELECT 
ENERGY_DAY."NODE",
ENERGY_DAY."NODETYPE",
RANK() OVER (PARTITION BY ENERGY_DAY."NODETYPE" ORDER BY ENERGY_DAY."PMCONSUMEDENERGYSUM" DESC) AS "ENERGYRANK"
FROM
(
SELECT
D1."ERBS" AS "NODE",
'4G' AS "NODETYPE",
SUM(D1."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D1
WHERE
D1."DATE_ID" >= @date AND D1."DATE_ID" < @dateDay 
AND D1."ROWSTATUS" = 'AGGREGATED' AND D1."ERBS" <> '' AND D1."ERBS" IS NOT NULL
GROUP BY D1."ERBS"
UNION 
SELECT
D2."RBS" AS "NODE",
'3G' AS "NODETYPE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."RBS" <> '' AND D2."RBS" IS NOT NULL
GROUP BY D2."RBS"
UNION
SELECT 
ENERGY_DAY_TCU."NODE",
ENERGY_NODES."NODETYPE",
ENERGY_DAY_TCU."PMCONSUMEDENERGYSUM"
FROM
(
SELECT
D2."NE_NAME" AS "NODE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."NE_NAME" <> '' AND D2."NE_NAME" IS NOT NULL
GROUP BY D2."NE_NAME"
)ENERGY_DAY_TCU,
(
SELECT 
D5."ERBS_NAME" AS "NODE",
'4G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_ERBS" D5

UNION
SELECT
D6."RBS_NAME" AS "NODE",
'3G' AS "NODETYPE",
D6."OSS_ID" AS "OSSID"
FROM "DIM_E_RAN_RBS" D6

UNION
SELECT
D7."RADIONODE_NAME" AS "NODE",
'2G' AS "NODETYPE",
D7."OSS_ID" AS "OSSID"
FROM "DIM_E_GRAN_RADIONODE" D7

)ENERGY_NODES
WHERE ENERGY_NODES."NODE" = ENERGY_DAY_TCU."NODE"
)ENERGY_DAY
)ENERGY_SUM,
(
SELECT 
 ERBS, 
 EUtrancellFDD,
 OSS_ID, 
 DATETIME_ID, 
 SUM(pmPdcpVolDlDrb) AS DataVolumeDown, 
 SUM(pmPdcpVolUlDrb) AS DataVolumeUp, 
 '4G' AS NODE_TYPE
 FROM (
  SELECT 
   ERBS, 
   EUtrancellFDD AS EUtrancellFDD,
   OSS_ID, 
   DATETIME_ID, 
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLFDD_RAW 
   WHERE DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
  UNION ALL
  SELECT 
   ERBS, 
   EUtrancellTDD AS EUtrancellFDD, 
   OSS_ID, 
   DATETIME_ID, 
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLTDD_RAW 
   WHERE DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
) pmPdcpVol 
GROUP BY ERBS, EUtrancellFDD, OSS_ID, DATETIME_ID
UNION
SELECT 
 dim_rbs.RBS_NAME AS ERBS, 
 dim_ucell.UCELL_NAME AS EUtrancellFDD, 
 ran.OSS_ID, 
 ran.DATETIME_ID, 
 SUM(
   pmDlTrafficVolumeAmr4750 
 + pmDlTrafficVolumeAmr5900 
 + pmDlTrafficVolumeAmr7950 
 + pmDlTrafficVolumeAmrNbMm 
 + pmDlTrafficVolumeAmrWb 
 + pmDlTrafficVolumeCs12 
 + pmDlTrafficVolumeCs57 
 + pmDlTrafficVolumeCs64 
 + pmDlTrafficVolumePs128 
 + pmDlTrafficVolumePs16 
 + pmDlTrafficVolumePs384 
 + pmDlTrafficVolumePs64 
 + pmDlTrafficVolumePs8 
 + pmDlTrafficVolumePsCommon 
 + pmDlTrafficVolumePsIntHs 
 + pmDlTrafficVolumePsStr128 
 + pmDlTrafficVolumePsStr16 
 + pmDlTrafficVolumePsStr64 
 + pmDlTrafficVolumePsStrHs 
 + pmDlTrafficVolumeSrb136 
 + pmDlTrafficVolumeSrb34 
 + pmDlTrafficVolumeSrbOnlyHs
 )AS DataVolumeDown, 
  SUM(
   pmUlTrafficVolumeAmr4750 
 + pmUlTrafficVolumeAmr5900 
 + pmUlTrafficVolumeAmr7950 
 + pmUlTrafficVolumeAmrNbMm 
 + pmUlTrafficVolumeAmrWb 
 + pmUlTrafficVolumeCs12 
 + pmUlTrafficVolumeCs57 
 + pmUlTrafficVolumeCs64 
 + pmUlTrafficVolumePs128 
 + pmUlTrafficVolumePs16 
 + pmUlTrafficVolumePs384 
 + pmUlTrafficVolumePs64 
 + pmUlTrafficVolumePs8 
 + pmUlTrafficVolumePsCommon 
 + pmUlTrafficVolumePsIntEul 
 + pmUlTrafficVolumePsIntEulFach 
 + pmUlTrafficVolumePsStr128 
 + pmUlTrafficVolumePsStr16 
 + pmUlTrafficVolumePsStr32 
 + pmUlTrafficVolumeSrb136 
 + pmUlTrafficVolumeSrb34 
 + pmUlTrafficVolumeSrbOnlyEul
) AS DataVolumeUp, 
'3G' AS NODE_TYPE
FROM DC_E_RAN_UCELL_RAW ran
INNER JOIN DIM_E_RAN_RBS dim_rbs ON dim_rbs.AssociatedRncName = ran.RNC
INNER JOIN DIM_E_RAN_UCELL dim_ucell ON dim_ucell.UCELL_NAME = ran.UtranCell AND dim_ucell.RBS_ID = dim_rbs.RBS_NAME
WHERE ran.DATETIME_ID >= @date AND ran.DATETIME_ID < @dateDay
GROUP BY ERBS, EUtrancellFDD, ran.OSS_ID, ran.DATETIME_ID
UNION
SELECT 
rn.RADIONODE_NAME AS ERBS,
CELL_NAME AS EUtrancellFDD,
D4.OSS_ID,
D4.DATETIME_ID,
SUM(
CELLGPRS3_DLSTRVOL + 
CELLGPRS3_DLINTBGVOL) as DataVolumeDown,
SUM(
CELLQOSS_VOLULSTRACC + 
CELLGPRS3_ULINTBGVOL + 
CELLEIT2_LLCVOLULEIT + 
CLDTMQOS_DTMULSTRDATA) as DataVolumeUp,
'2G' AS NODE_TYPE
FROM
DC_E_BSS_CELL_PS_RAW D4
INNER JOIN DIM_E_GRAN_RADIONODE_TRX trx ON D4.CELL_NAME = trx.GSMSECTOR
INNER JOIN DIM_E_GRAN_RADIONODE rn ON trx.RADIONODE = rn.RADIONODE_NAME
WHERE D4.DATETIME_ID >= @date AND D4.DATETIME_ID < @dateDay 
GROUP BY ERBS, EUtrancellFDD, D4.OSS_ID, D4.DATETIME_ID
)D1
WHERE ENERGY_SUM."ENERGYRANK" <= 100
AND ENERGY_SUM."NODE" = D1."ERBS"
AND <conditions>



ELSE IF(@nodes LIKE 'LTEWCDMA')
SELECT 
ENERGY_SUM."NODE" AS "ERBS",
D1."EUtrancellFDD" AS "EUtrancellFDD",
D1."OSS_ID" AS "OSS_ID",
D1."DATETIME_ID" AS "DATETIME_ID",
D1."DataVolumeDown" AS "DataVolumeDown",
D1."DataVolumeUp" AS "DataVolumeUp",
D1."NODE_TYPE" AS "NODETYPE"
FROM 
(
SELECT 
ENERGY_DAY."NODE",
ENERGY_DAY."NODETYPE",
RANK() OVER (PARTITION BY ENERGY_DAY."NODETYPE" ORDER BY ENERGY_DAY."PMCONSUMEDENERGYSUM" DESC) AS "ENERGYRANK"
FROM
(
SELECT
D1."ERBS" AS "NODE",
'4G' AS "NODETYPE",
SUM(D1."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D1
WHERE
D1."DATE_ID" >= @date AND D1."DATE_ID" < @dateDay 
AND D1."ROWSTATUS" = 'AGGREGATED' AND D1."ERBS" <> '' AND D1."ERBS" IS NOT NULL
GROUP BY D1."ERBS"
UNION 
SELECT
D2."RBS" AS "NODE",
'3G' AS "NODETYPE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."RBS" <> '' AND D2."RBS" IS NOT NULL
GROUP BY D2."RBS"
UNION
SELECT 
ENERGY_DAY_TCU."NODE",
ENERGY_NODES."NODETYPE",
ENERGY_DAY_TCU."PMCONSUMEDENERGYSUM"
FROM
(
SELECT
D2."NE_NAME" AS "NODE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."NE_NAME" <> '' AND D2."NE_NAME" IS NOT NULL
GROUP BY D2."NE_NAME"
)ENERGY_DAY_TCU,
(
SELECT 
D5."ERBS_NAME" AS "NODE",
'4G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_ERBS" D5

UNION
SELECT
D6."RBS_NAME" AS "NODE",
'3G' AS "NODETYPE",
D6."OSS_ID" AS "OSSID"
FROM "DIM_E_RAN_RBS" D6

)ENERGY_NODES
WHERE ENERGY_NODES."NODE" = ENERGY_DAY_TCU."NODE"
)ENERGY_DAY
)ENERGY_SUM,
(
SELECT 
 ERBS, 
 EUtrancellFDD,
 OSS_ID, 
 DATETIME_ID, 
 SUM(pmPdcpVolDlDrb) AS DataVolumeDown, 
 SUM(pmPdcpVolUlDrb) AS DataVolumeUp, 
 '4G' AS NODE_TYPE
 FROM (
  SELECT 
   ERBS, 
   EUtrancellFDD AS EUtrancellFDD,
   OSS_ID, 
   DATETIME_ID, 
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLFDD_RAW 
   WHERE DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
  UNION ALL
  SELECT 
   ERBS, 
   EUtrancellTDD AS EUtrancellFDD, 
   OSS_ID, 
   DATETIME_ID, 
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLTDD_RAW 
   WHERE DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
) pmPdcpVol 
GROUP BY ERBS, EUtrancellFDD, OSS_ID, DATETIME_ID
UNION
SELECT 
 dim_rbs.RBS_NAME AS ERBS, 
 dim_ucell.UCELL_NAME AS EUtrancellFDD, 
 ran.OSS_ID, 
 ran.DATETIME_ID, 
 SUM(
   pmDlTrafficVolumeAmr4750 
 + pmDlTrafficVolumeAmr5900 
 + pmDlTrafficVolumeAmr7950 
 + pmDlTrafficVolumeAmrNbMm 
 + pmDlTrafficVolumeAmrWb 
 + pmDlTrafficVolumeCs12 
 + pmDlTrafficVolumeCs57 
 + pmDlTrafficVolumeCs64 
 + pmDlTrafficVolumePs128 
 + pmDlTrafficVolumePs16 
 + pmDlTrafficVolumePs384 
 + pmDlTrafficVolumePs64 
 + pmDlTrafficVolumePs8 
 + pmDlTrafficVolumePsCommon 
 + pmDlTrafficVolumePsIntHs 
 + pmDlTrafficVolumePsStr128 
 + pmDlTrafficVolumePsStr16 
 + pmDlTrafficVolumePsStr64 
 + pmDlTrafficVolumePsStrHs 
 + pmDlTrafficVolumeSrb136 
 + pmDlTrafficVolumeSrb34 
 + pmDlTrafficVolumeSrbOnlyHs
 )AS DataVolumeDown, 
  SUM(
   pmUlTrafficVolumeAmr4750 
 + pmUlTrafficVolumeAmr5900 
 + pmUlTrafficVolumeAmr7950 
 + pmUlTrafficVolumeAmrNbMm 
 + pmUlTrafficVolumeAmrWb 
 + pmUlTrafficVolumeCs12 
 + pmUlTrafficVolumeCs57 
 + pmUlTrafficVolumeCs64 
 + pmUlTrafficVolumePs128 
 + pmUlTrafficVolumePs16 
 + pmUlTrafficVolumePs384 
 + pmUlTrafficVolumePs64 
 + pmUlTrafficVolumePs8 
 + pmUlTrafficVolumePsCommon 
 + pmUlTrafficVolumePsIntEul 
 + pmUlTrafficVolumePsIntEulFach 
 + pmUlTrafficVolumePsStr128 
 + pmUlTrafficVolumePsStr16 
 + pmUlTrafficVolumePsStr32 
 + pmUlTrafficVolumeSrb136 
 + pmUlTrafficVolumeSrb34 
 + pmUlTrafficVolumeSrbOnlyEul
) AS DataVolumeUp, 
'3G' AS NODE_TYPE
FROM DC_E_RAN_UCELL_RAW ran
INNER JOIN DIM_E_RAN_RBS dim_rbs ON dim_rbs.AssociatedRncName = ran.RNC
INNER JOIN DIM_E_RAN_UCELL dim_ucell ON dim_ucell.UCELL_NAME = ran.UtranCell AND dim_ucell.RBS_ID = dim_rbs.RBS_NAME
WHERE ran.DATETIME_ID >= @date AND ran.DATETIME_ID < @dateDay
GROUP BY ERBS, EUtrancellFDD, ran.OSS_ID, ran.DATETIME_ID
)D1
WHERE ENERGY_SUM."ENERGYRANK" <= 100
AND ENERGY_SUM."NODE" = D1."ERBS"
AND <conditions>



ELSE IF(@nodes LIKE 'LTEGSM')
SELECT 
ENERGY_SUM."NODE" AS "ERBS",
D1."EUtrancellFDD" AS "EUtrancellFDD",
D1."OSS_ID" AS "OSS_ID",
D1."DATETIME_ID" AS "DATETIME_ID",
D1."DataVolumeDown" AS "DataVolumeDown",
D1."DataVolumeUp" AS "DataVolumeUp",
D1."NODE_TYPE" AS "NODETYPE"
FROM 
(
SELECT 
ENERGY_DAY."NODE",
ENERGY_DAY."NODETYPE",
RANK() OVER (PARTITION BY ENERGY_DAY."NODETYPE" ORDER BY ENERGY_DAY."PMCONSUMEDENERGYSUM" DESC) AS "ENERGYRANK"
FROM
(
SELECT
D1."ERBS" AS "NODE",
'4G' AS "NODETYPE",
SUM(D1."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D1
WHERE
D1."DATE_ID" >= @date AND D1."DATE_ID" < @dateDay 
AND D1."ROWSTATUS" = 'AGGREGATED' AND D1."ERBS" <> '' AND D1."ERBS" IS NOT NULL
GROUP BY D1."ERBS"
UNION 
SELECT
D2."RBS" AS "NODE",
'3G' AS "NODETYPE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."RBS" <> '' AND D2."RBS" IS NOT NULL
GROUP BY D2."RBS"
UNION
SELECT 
ENERGY_DAY_TCU."NODE",
ENERGY_NODES."NODETYPE",
ENERGY_DAY_TCU."PMCONSUMEDENERGYSUM"
FROM
(
SELECT
D2."NE_NAME" AS "NODE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."NE_NAME" <> '' AND D2."NE_NAME" IS NOT NULL
GROUP BY D2."NE_NAME"
)ENERGY_DAY_TCU,
(
SELECT 
D5."ERBS_NAME" AS "NODE",
'4G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_ERBS" D5

UNION
SELECT
D7."RADIONODE_NAME" AS "NODE",
'2G' AS "NODETYPE",
D7."OSS_ID" AS "OSSID"
FROM "DIM_E_GRAN_RADIONODE" D7

)ENERGY_NODES
WHERE ENERGY_NODES."NODE" = ENERGY_DAY_TCU."NODE"
)ENERGY_DAY
)ENERGY_SUM,
(
SELECT 
 ERBS, 
 EUtrancellFDD,
 OSS_ID, 
 DATETIME_ID, 
 SUM(pmPdcpVolDlDrb) AS DataVolumeDown, 
 SUM(pmPdcpVolUlDrb) AS DataVolumeUp, 
 '4G' AS NODE_TYPE
 FROM (
  SELECT 
   ERBS, 
   EUtrancellFDD AS EUtrancellFDD,
   OSS_ID, 
   DATETIME_ID, 
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLFDD_RAW 
   WHERE DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
  UNION ALL
  SELECT 
   ERBS, 
   EUtrancellTDD AS EUtrancellFDD, 
   OSS_ID, 
   DATETIME_ID, 
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLTDD_RAW 
   WHERE DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
) pmPdcpVol 
GROUP BY ERBS, EUtrancellFDD, OSS_ID, DATETIME_ID
UNION
SELECT 
rn.RADIONODE_NAME AS ERBS,
CELL_NAME AS EUtrancellFDD,
D4.OSS_ID,
D4.DATETIME_ID,
SUM(
CELLGPRS3_DLSTRVOL + 
CELLGPRS3_DLINTBGVOL) as DataVolumeDown,
SUM(
CELLQOSS_VOLULSTRACC + 
CELLGPRS3_ULINTBGVOL + 
CELLEIT2_LLCVOLULEIT + 
CLDTMQOS_DTMULSTRDATA) as DataVolumeUp,
'2G' AS NODE_TYPE
FROM
DC_E_BSS_CELL_PS_RAW D4
INNER JOIN DIM_E_GRAN_RADIONODE_TRX trx ON D4.CELL_NAME = trx.GSMSECTOR
INNER JOIN DIM_E_GRAN_RADIONODE rn ON trx.RADIONODE = rn.RADIONODE_NAME
WHERE D4.DATETIME_ID >= @date AND D4.DATETIME_ID < @dateDay 
GROUP BY ERBS, EUtrancellFDD, D4.OSS_ID, D4.DATETIME_ID
)D1
WHERE ENERGY_SUM."ENERGYRANK" <= 100
AND ENERGY_SUM."NODE" = D1."ERBS"
AND <conditions>



ELSE IF(@nodes LIKE 'WCDMAGSM')
SELECT 
ENERGY_SUM."NODE" AS "ERBS",
D1."EUtrancellFDD" AS "EUtrancellFDD",
D1."OSS_ID" AS "OSS_ID",
D1."DATETIME_ID" AS "DATETIME_ID",
D1."DataVolumeDown" AS "DataVolumeDown",
D1."DataVolumeUp" AS "DataVolumeUp",
D1."NODE_TYPE" AS "NODETYPE"
FROM 
(
SELECT 
ENERGY_DAY."NODE",
ENERGY_DAY."NODETYPE",
RANK() OVER (PARTITION BY ENERGY_DAY."NODETYPE" ORDER BY ENERGY_DAY."PMCONSUMEDENERGYSUM" DESC) AS "ENERGYRANK"
FROM
(
SELECT
D1."ERBS" AS "NODE",
'4G' AS "NODETYPE",
SUM(D1."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D1
WHERE
D1."DATE_ID" >= @date AND D1."DATE_ID" < @dateDay 
AND D1."ROWSTATUS" = 'AGGREGATED' AND D1."ERBS" <> '' AND D1."ERBS" IS NOT NULL
GROUP BY D1."ERBS"
UNION 
SELECT
D2."RBS" AS "NODE",
'3G' AS "NODETYPE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."RBS" <> '' AND D2."RBS" IS NOT NULL
GROUP BY D2."RBS"
UNION
SELECT 
ENERGY_DAY_TCU."NODE",
ENERGY_NODES."NODETYPE",
ENERGY_DAY_TCU."PMCONSUMEDENERGYSUM"
FROM
(
SELECT
D2."NE_NAME" AS "NODE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."NE_NAME" <> '' AND D2."NE_NAME" IS NOT NULL
GROUP BY D2."NE_NAME"
)ENERGY_DAY_TCU,
(
SELECT
D6."RBS_NAME" AS "NODE",
'3G' AS "NODETYPE",
D6."OSS_ID" AS "OSSID"
FROM "DIM_E_RAN_RBS" D6

UNION
SELECT
D7."RADIONODE_NAME" AS "NODE",
'2G' AS "NODETYPE",
D7."OSS_ID" AS "OSSID"
FROM "DIM_E_GRAN_RADIONODE" D7

)ENERGY_NODES
WHERE ENERGY_NODES."NODE" = ENERGY_DAY_TCU."NODE"
)ENERGY_DAY
)ENERGY_SUM,
(
SELECT 
 dim_rbs.RBS_NAME AS ERBS, 
 dim_ucell.UCELL_NAME AS EUtrancellFDD, 
 ran.OSS_ID, 
 ran.DATETIME_ID, 
 SUM(
   pmDlTrafficVolumeAmr4750 
 + pmDlTrafficVolumeAmr5900 
 + pmDlTrafficVolumeAmr7950 
 + pmDlTrafficVolumeAmrNbMm 
 + pmDlTrafficVolumeAmrWb 
 + pmDlTrafficVolumeCs12 
 + pmDlTrafficVolumeCs57 
 + pmDlTrafficVolumeCs64 
 + pmDlTrafficVolumePs128 
 + pmDlTrafficVolumePs16 
 + pmDlTrafficVolumePs384 
 + pmDlTrafficVolumePs64 
 + pmDlTrafficVolumePs8 
 + pmDlTrafficVolumePsCommon 
 + pmDlTrafficVolumePsIntHs 
 + pmDlTrafficVolumePsStr128 
 + pmDlTrafficVolumePsStr16 
 + pmDlTrafficVolumePsStr64 
 + pmDlTrafficVolumePsStrHs 
 + pmDlTrafficVolumeSrb136 
 + pmDlTrafficVolumeSrb34 
 + pmDlTrafficVolumeSrbOnlyHs
 )AS DataVolumeDown, 
  SUM(
   pmUlTrafficVolumeAmr4750 
 + pmUlTrafficVolumeAmr5900 
 + pmUlTrafficVolumeAmr7950 
 + pmUlTrafficVolumeAmrNbMm 
 + pmUlTrafficVolumeAmrWb 
 + pmUlTrafficVolumeCs12 
 + pmUlTrafficVolumeCs57 
 + pmUlTrafficVolumeCs64 
 + pmUlTrafficVolumePs128 
 + pmUlTrafficVolumePs16 
 + pmUlTrafficVolumePs384 
 + pmUlTrafficVolumePs64 
 + pmUlTrafficVolumePs8 
 + pmUlTrafficVolumePsCommon 
 + pmUlTrafficVolumePsIntEul 
 + pmUlTrafficVolumePsIntEulFach 
 + pmUlTrafficVolumePsStr128 
 + pmUlTrafficVolumePsStr16 
 + pmUlTrafficVolumePsStr32 
 + pmUlTrafficVolumeSrb136 
 + pmUlTrafficVolumeSrb34 
 + pmUlTrafficVolumeSrbOnlyEul
) AS DataVolumeUp, 
'3G' AS NODE_TYPE
FROM DC_E_RAN_UCELL_RAW ran
INNER JOIN DIM_E_RAN_RBS dim_rbs ON dim_rbs.AssociatedRncName = ran.RNC
INNER JOIN DIM_E_RAN_UCELL dim_ucell ON dim_ucell.UCELL_NAME = ran.UtranCell AND dim_ucell.RBS_ID = dim_rbs.RBS_NAME
WHERE ran.DATETIME_ID >= @date AND ran.DATETIME_ID < @dateDay
GROUP BY ERBS, EUtrancellFDD, ran.OSS_ID, ran.DATETIME_ID
UNION
SELECT 
rn.RADIONODE_NAME AS ERBS,
CELL_NAME AS EUtrancellFDD,
D4.OSS_ID,
D4.DATETIME_ID,
SUM(
CELLGPRS3_DLSTRVOL + 
CELLGPRS3_DLINTBGVOL) as DataVolumeDown,
SUM(
CELLQOSS_VOLULSTRACC + 
CELLGPRS3_ULINTBGVOL + 
CELLEIT2_LLCVOLULEIT + 
CLDTMQOS_DTMULSTRDATA) as DataVolumeUp,
'2G' AS NODE_TYPE
FROM
DC_E_BSS_CELL_PS_RAW D4
INNER JOIN DIM_E_GRAN_RADIONODE_TRX trx ON D4.CELL_NAME = trx.GSMSECTOR
INNER JOIN DIM_E_GRAN_RADIONODE rn ON trx.RADIONODE = rn.RADIONODE_NAME
WHERE D4.DATETIME_ID >= @date AND D4.DATETIME_ID < @dateDay 
GROUP BY ERBS, EUtrancellFDD, D4.OSS_ID, D4.DATETIME_ID
)D1
WHERE ENERGY_SUM."ENERGYRANK" <= 100
AND ENERGY_SUM."NODE" = D1."ERBS"
AND <conditions>



ELSE IF(@nodes LIKE 'LTE')
SELECT 
ENERGY_SUM."NODE" AS "ERBS",
D1."EUtrancellFDD" AS "EUtrancellFDD",
D1."OSS_ID" AS "OSS_ID",
D1."DATETIME_ID" AS "DATETIME_ID",
D1."DataVolumeDown" AS "DataVolumeDown",
D1."DataVolumeUp" AS "DataVolumeUp",
D1."NODE_TYPE" AS "NODETYPE"
FROM 
(
SELECT 
ENERGY_DAY."NODE",
ENERGY_DAY."NODETYPE",
RANK() OVER (PARTITION BY ENERGY_DAY."NODETYPE" ORDER BY ENERGY_DAY."PMCONSUMEDENERGYSUM" DESC) AS "ENERGYRANK"
FROM
(
SELECT
D1."ERBS" AS "NODE",
'4G' AS "NODETYPE",
SUM(D1."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D1
WHERE
D1."DATE_ID" >= @date AND D1."DATE_ID" < @dateDay 
AND D1."ROWSTATUS" = 'AGGREGATED' AND D1."ERBS" <> '' AND D1."ERBS" IS NOT NULL
GROUP BY D1."ERBS"
UNION 
SELECT
D2."RBS" AS "NODE",
'3G' AS "NODETYPE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."RBS" <> '' AND D2."RBS" IS NOT NULL
GROUP BY D2."RBS"
UNION
SELECT 
ENERGY_DAY_TCU."NODE",
ENERGY_NODES."NODETYPE",
ENERGY_DAY_TCU."PMCONSUMEDENERGYSUM"
FROM
(
SELECT
D2."NE_NAME" AS "NODE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."NE_NAME" <> '' AND D2."NE_NAME" IS NOT NULL
GROUP BY D2."NE_NAME"
)ENERGY_DAY_TCU,
(
SELECT 
D5."ERBS_NAME" AS "NODE",
'4G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_ERBS" D5

)ENERGY_NODES
WHERE ENERGY_NODES."NODE" = ENERGY_DAY_TCU."NODE"
)ENERGY_DAY
)ENERGY_SUM,
(
SELECT 
 ERBS, 
 EUtrancellFDD,
 OSS_ID, 
 DATETIME_ID, 
 SUM(pmPdcpVolDlDrb) AS DataVolumeDown, 
 SUM(pmPdcpVolUlDrb) AS DataVolumeUp, 
 '4G' AS NODE_TYPE
 FROM (
  SELECT 
   ERBS, 
   EUtrancellFDD AS EUtrancellFDD,
   OSS_ID, 
   DATETIME_ID, 
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLFDD_RAW 
   WHERE DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
  UNION ALL
  SELECT 
   ERBS, 
   EUtrancellTDD AS EUtrancellFDD, 
   OSS_ID, 
   DATETIME_ID, 
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLTDD_RAW 
   WHERE DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
) pmPdcpVol 
GROUP BY ERBS, EUtrancellFDD, OSS_ID, DATETIME_ID
)D1
WHERE ENERGY_SUM."ENERGYRANK" <= 100
AND ENERGY_SUM."NODE" = D1."ERBS"
AND <conditions>



ELSE IF(@nodes LIKE 'WCDMA')
SELECT 
ENERGY_SUM."NODE" AS "ERBS",
D1."EUtrancellFDD" AS "EUtrancellFDD",
D1."OSS_ID" AS "OSS_ID",
D1."DATETIME_ID" AS "DATETIME_ID",
D1."DataVolumeDown" AS "DataVolumeDown",
D1."DataVolumeUp" AS "DataVolumeUp",
D1."NODE_TYPE" AS "NODETYPE"
FROM 
(
SELECT 
ENERGY_DAY."NODE",
ENERGY_DAY."NODETYPE",
RANK() OVER (PARTITION BY ENERGY_DAY."NODETYPE" ORDER BY ENERGY_DAY."PMCONSUMEDENERGYSUM" DESC) AS "ENERGYRANK"
FROM
(
SELECT
D1."ERBS" AS "NODE",
'4G' AS "NODETYPE",
SUM(D1."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D1
WHERE
D1."DATE_ID" >= @date AND D1."DATE_ID" < @dateDay 
AND D1."ROWSTATUS" = 'AGGREGATED' AND D1."ERBS" <> '' AND D1."ERBS" IS NOT NULL
GROUP BY D1."ERBS"
UNION 
SELECT
D2."RBS" AS "NODE",
'3G' AS "NODETYPE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."RBS" <> '' AND D2."RBS" IS NOT NULL
GROUP BY D2."RBS"
UNION
SELECT 
ENERGY_DAY_TCU."NODE",
ENERGY_NODES."NODETYPE",
ENERGY_DAY_TCU."PMCONSUMEDENERGYSUM"
FROM
(
SELECT
D2."NE_NAME" AS "NODE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."NE_NAME" <> '' AND D2."NE_NAME" IS NOT NULL
GROUP BY D2."NE_NAME"
)ENERGY_DAY_TCU,
(
SELECT
D6."RBS_NAME" AS "NODE",
'3G' AS "NODETYPE",
D6."OSS_ID" AS "OSSID"
FROM "DIM_E_RAN_RBS" D6

)ENERGY_NODES
WHERE ENERGY_NODES."NODE" = ENERGY_DAY_TCU."NODE"
)ENERGY_DAY
)ENERGY_SUM,
(
SELECT 
 dim_rbs.RBS_NAME AS ERBS, 
 dim_ucell.UCELL_NAME AS EUtrancellFDD, 
 ran.OSS_ID, 
 ran.DATETIME_ID, 
 SUM(
   pmDlTrafficVolumeAmr4750 
 + pmDlTrafficVolumeAmr5900 
 + pmDlTrafficVolumeAmr7950 
 + pmDlTrafficVolumeAmrNbMm 
 + pmDlTrafficVolumeAmrWb 
 + pmDlTrafficVolumeCs12 
 + pmDlTrafficVolumeCs57 
 + pmDlTrafficVolumeCs64 
 + pmDlTrafficVolumePs128 
 + pmDlTrafficVolumePs16 
 + pmDlTrafficVolumePs384 
 + pmDlTrafficVolumePs64 
 + pmDlTrafficVolumePs8 
 + pmDlTrafficVolumePsCommon 
 + pmDlTrafficVolumePsIntHs 
 + pmDlTrafficVolumePsStr128 
 + pmDlTrafficVolumePsStr16 
 + pmDlTrafficVolumePsStr64 
 + pmDlTrafficVolumePsStrHs 
 + pmDlTrafficVolumeSrb136 
 + pmDlTrafficVolumeSrb34 
 + pmDlTrafficVolumeSrbOnlyHs
 )AS DataVolumeDown, 
  SUM(
   pmUlTrafficVolumeAmr4750 
 + pmUlTrafficVolumeAmr5900 
 + pmUlTrafficVolumeAmr7950 
 + pmUlTrafficVolumeAmrNbMm 
 + pmUlTrafficVolumeAmrWb 
 + pmUlTrafficVolumeCs12 
 + pmUlTrafficVolumeCs57 
 + pmUlTrafficVolumeCs64 
 + pmUlTrafficVolumePs128 
 + pmUlTrafficVolumePs16 
 + pmUlTrafficVolumePs384 
 + pmUlTrafficVolumePs64 
 + pmUlTrafficVolumePs8 
 + pmUlTrafficVolumePsCommon 
 + pmUlTrafficVolumePsIntEul 
 + pmUlTrafficVolumePsIntEulFach 
 + pmUlTrafficVolumePsStr128 
 + pmUlTrafficVolumePsStr16 
 + pmUlTrafficVolumePsStr32 
 + pmUlTrafficVolumeSrb136 
 + pmUlTrafficVolumeSrb34 
 + pmUlTrafficVolumeSrbOnlyEul
) AS DataVolumeUp, 
'3G' AS NODE_TYPE
FROM DC_E_RAN_UCELL_RAW ran
INNER JOIN DIM_E_RAN_RBS dim_rbs ON dim_rbs.AssociatedRncName = ran.RNC
INNER JOIN DIM_E_RAN_UCELL dim_ucell ON dim_ucell.UCELL_NAME = ran.UtranCell AND dim_ucell.RBS_ID = dim_rbs.RBS_NAME
WHERE ran.DATETIME_ID >= @date AND ran.DATETIME_ID < @dateDay
GROUP BY ERBS, EUtrancellFDD, ran.OSS_ID, ran.DATETIME_ID
)D1
WHERE ENERGY_SUM."ENERGYRANK" <= 100
AND ENERGY_SUM."NODE" = D1."ERBS"
AND <conditions>



ELSE IF(@nodes LIKE 'GSM')
SELECT 
ENERGY_SUM."NODE" AS "ERBS",
D1."EUtrancellFDD" AS "EUtrancellFDD",
D1."OSS_ID" AS "OSS_ID",
D1."DATETIME_ID" AS "DATETIME_ID",
D1."DataVolumeDown" AS "DataVolumeDown",
D1."DataVolumeUp" AS "DataVolumeUp",
D1."NODE_TYPE" AS "NODETYPE"
FROM 
(
SELECT 
ENERGY_DAY."NODE",
ENERGY_DAY."NODETYPE",
RANK() OVER (PARTITION BY ENERGY_DAY."NODETYPE" ORDER BY ENERGY_DAY."PMCONSUMEDENERGYSUM" DESC) AS "ENERGYRANK"
FROM
(
SELECT
D1."ERBS" AS "NODE",
'4G' AS "NODETYPE",
SUM(D1."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D1
WHERE
D1."DATE_ID" >= @date AND D1."DATE_ID" < @dateDay 
AND D1."ROWSTATUS" = 'AGGREGATED' AND D1."ERBS" <> '' AND D1."ERBS" IS NOT NULL
GROUP BY D1."ERBS"
UNION 
SELECT
D2."RBS" AS "NODE",
'3G' AS "NODETYPE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."RBS" <> '' AND D2."RBS" IS NOT NULL
GROUP BY D2."RBS"
UNION
SELECT 
ENERGY_DAY_TCU."NODE",
ENERGY_NODES."NODETYPE",
ENERGY_DAY_TCU."PMCONSUMEDENERGYSUM"
FROM
(
SELECT
D2."NE_NAME" AS "NODE",
SUM(D2."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGYSUM"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D2
WHERE
D2."DATE_ID" >= @date AND D2."DATE_ID" < @dateDay 
AND D2."ROWSTATUS" = 'AGGREGATED' AND D2."NE_NAME" <> '' AND D2."NE_NAME" IS NOT NULL
GROUP BY D2."NE_NAME"
)ENERGY_DAY_TCU,
(
SELECT
D7."RADIONODE_NAME" AS "NODE",
'2G' AS "NODETYPE",
D7."OSS_ID" AS "OSSID"
FROM "DIM_E_GRAN_RADIONODE" D7

)ENERGY_NODES
WHERE ENERGY_NODES."NODE" = ENERGY_DAY_TCU."NODE"
)ENERGY_DAY
)ENERGY_SUM,
(
SELECT 
rn.RADIONODE_NAME AS ERBS,
CELL_NAME AS EUtrancellFDD,
D4.OSS_ID,
D4.DATETIME_ID,
SUM(
CELLGPRS3_DLSTRVOL + 
CELLGPRS3_DLINTBGVOL) as DataVolumeDown,
SUM(
CELLQOSS_VOLULSTRACC + 
CELLGPRS3_ULINTBGVOL + 
CELLEIT2_LLCVOLULEIT + 
CLDTMQOS_DTMULSTRDATA) as DataVolumeUp,
'2G' AS NODE_TYPE
FROM
DC_E_BSS_CELL_PS_RAW D4
INNER JOIN DIM_E_GRAN_RADIONODE_TRX trx ON D4.CELL_NAME = trx.GSMSECTOR
INNER JOIN DIM_E_GRAN_RADIONODE rn ON trx.RADIONODE = rn.RADIONODE_NAME
WHERE D4.DATETIME_ID >= @date AND D4.DATETIME_ID < @dateDay 
GROUP BY ERBS, EUtrancellFDD, D4.OSS_ID, D4.DATETIME_ID
)D1
WHERE ENERGY_SUM."ENERGYRANK" <= 100
AND ENERGY_SUM."NODE" = D1."ERBS"
AND <conditions>


###############################################################################################################
Information Link Name:IL_DC_BULK_CM_AUXPLUGUNIT_RAW_6MONTHS
DECLARE @date DATE
SET @date = DATEADD(mm, -6, GETDATE())
DECLARE @dateDay DATE
SET @dateDay = CAST(getdate() AS DATE)
SELECT DISTINCT
D1."DATE_ID" AS "DATEID",
D1."ELEMENT" AS "NODE",
D1."MOID" AS "MOID",
D1."OSS_ID" AS "OSSID",
D1."productData_productName" AS "HARDWARE_NAME",
D1."AuxPlugInUnit" AS "AUXPLUGINUNIT"
FROM DC_E_BULK_CM_AUXPLUGINUNIT_RAW D1
WHERE
D1."DATE_ID" >= @date
AND D1."DATE_ID" < @dateDay
AND D1."productData_productName" != ''
AND <conditions>

###############################################################################################################
Information Link Name:IL_DC_BULK_CM_AUXPLUGUNIT_RAW_DOD
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

SELECT
D1."DATE_ID" AS "DATEID",
D1."ELEMENT" AS "NODE",
D1."MOID" AS "MOID",
D1."OSS_ID" AS "OSSID",
D1."productData_productName" AS "HARDWARE_NAME",
D1."AuxPlugInUnit" AS "AUXPLUGINUNIT"
FROM DC_E_BULK_CM_AUXPLUGINUNIT_raw D1
WHERE
D1."DATETIME_ID" >= @date
AND D1."DATETIME_ID" < @dateDay
AND D1."productData_productName" != ''
AND <conditions>

###############################################################################################################
Information Link Name:IL_DC_E_BULK_CM_FEATURESTATE
DECLARE @date DATE
SET @date = CAST(DATEADD(dd, -7, GETDATE()) AS DATE)
DECLARE @dateDay DATE
SET @dateDay = CAST(DATEADD(dd,-1,GETDATE()) AS DATE)

DECLARE @nodes VARCHAR(50)
SET @nodes = ''

IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_BTSG2_GSMSECTOR_RAW') > 0)
SET @nodes = @nodes + 'GSM'

IF(@nodes='GSM')
SELECT
   D1."ELEMENT" AS "ELEMENT",
   D1."MOID" AS "MOID",
   D1."FEATURENAME" AS "FEATURENAME",
   D1."FEATURESTATE" AS "FEATURESTATE",
   D1."LICENSESTATE" AS "LICENSESTATE",
   D1."SERVICESTATE" AS "SERVICESTATE",
   D1."DATEID" AS "DATEID",
   D1."OSSID" AS "OSSID"
FROM (
        SELECT  
        FS.ELEMENT AS "ELEMENT",
        FS.MOID AS "MOID",
        FK.NAME AS "FEATURENAME", 
        CASE 
        WHEN FS.FEATURESTATE = 0 THEN 'Not Installed' 
        WHEN FS.FEATURESTATE = 1 THEN 'Installed' 
        END AS "FEATURESTATE", 
        CASE 
        WHEN FS.LICENSESTATE = 0 THEN 'Not Available' 
        WHEN FS.LICENSESTATE = 1 THEN 'Available' 
        END AS "LICENSESTATE", 
        CASE 
        WHEN FS.SERVICESTATE = 0 THEN 'Inactive' 
        WHEN FS.SERVICESTATE = 1 THEN 'Active' 
        END AS "SERVICESTATE", 
        FS.DATE_ID AS "DATEID",
        FS.OSS_ID AS "OSSID"
        FROM 
        DC_E_BULK_CM_FEATUREKEY_RAW FK,
        DC_E_BULK_CM_FEATURESTATE_RAW FS
        WHERE FK.KEYID = FS.KEYID
        AND FS.DATE_ID <= (SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_FEATURESTATE_RAW WHERE DATE_ID <= @dateDay)
        AND FS.DATE_ID >= (SELECT MIN(DATE_ID) FROM DC_E_BULK_CM_FEATURESTATE_RAW WHERE DATE_ID >= @date)
        AND FK.DATE_ID <= (SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_FEATUREKEY_RAW WHERE DATE_ID <= @dateDay)
        AND FK.DATE_ID >= (SELECT MIN(DATE_ID) FROM DC_E_BULK_CM_FEATUREKEY_RAW WHERE DATE_ID >= @date)
        AND FS.ELEMENT = FK.ELEMENT
        AND FS.DATE_ID = FK.DATE_ID
        AND FK.NAME IN (
        'LteAiPoweredMimoSleepMode',
        'NrDynamicPowerOptimizer',
        'NrServiceAdaptiveDrx',
        'CellSleepMode',
        'MIMOSleepMode',
        'MicroSleepTx',
        'LowEnergySchedulerSolution',
        'TrafficAwarePowerSave')
        UNION
        SELECT 
        PS.ELEMENT AS "ELEMENT",
        PS.MOID AS "MOID",
        'MCPA Tx Power' AS "FEATURENAME",
        CASE 
        WHEN PS.mcpaPsWantedState = 0 THEN 'Not Installed'
        WHEN PS.mcpaPsWantedState = 1 THEN 'Installed'
        END AS "FEATURESTATE",
        CASE 
        WHEN PS.mcpaPsWantedState = 0 THEN 'Not Available'
        WHEN PS.mcpaPsWantedState = 1 THEN 'Available'
        END AS "LICENSESTATE",
        CASE 
        WHEN PS.mcpaPsWantedState = 0 THEN 'Inactive'
        WHEN PS.mcpaPsWantedState = 1 THEN 'Active'
        END AS "SERVICESTATE", 
        PS.DATE_ID AS "DATEID",
        PS.OSS_ID AS "OSSID"
        FROM DC_E_BULK_CM_POWERSAVINGS_RAW PS
        WHERE PS.DATE_ID <= (SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_POWERSAVINGS_RAW WHERE DATE_ID <= @dateDay)
        AND PS.DATE_ID >= (SELECT MIN(DATE_ID) FROM DC_E_BULK_CM_FEATUREKEY_RAW WHERE DATE_ID >= @date)
        UNION
        SELECT 
        PS.ELEMENT AS "ELEMENT",
        PS.MOID AS "MOID",
        'BCCH Power Savings' AS "FEATURENAME",
        CASE 
        WHEN PS.BCCHPS = 0 THEN 'Not Installed'
        WHEN PS.BCCHPS = 1 THEN 'Installed'
        END AS "FEATURESTATE",
        CASE 
        WHEN PS.BCCHPS = 0 THEN 'Not Available'
        WHEN PS.BCCHPS = 1 THEN 'Available'
        END AS "LICENSESTATE",
        CASE 
        WHEN PS.BCCHPS = 0 THEN 'Inactive'
        WHEN PS.BCCHPS = 1 THEN 'Active'
        END AS "SERVICESTATE",
        PS.DATE_ID AS "DATEID",
        PS.OSS_ID AS "OSSID"
        FROM DC_E_BULK_CM_POWERSAVINGS_RAW PS
        WHERE PS.DATE_ID <= (SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_POWERSAVINGS_RAW WHERE DATE_ID <= @dateDay)
        AND PS.DATE_ID >= (SELECT MIN(DATE_ID) FROM DC_E_BULK_CM_FEATUREKEY_RAW WHERE DATE_ID >= @date)
        UNION
        SELECT 
        DISTINCT GSM.BTS AS "ELEMENT",
        GSM.GsmSector AS "MOID",
        'Micro Sleep Tx GSM' AS "FEATURENAME",
        'Installed' AS "FEATURESTATE",
        'Available' AS "LICENSESTATE",
        'Active' AS "SERVICESTATE",
        GSM.DATE_ID AS "DATEID",
        GSM.OSS_ID AS "OSSID"
        FROM DC_E_BTSG2_GSMSECTOR_RAW GSM
        WHERE GSM.DATE_ID = (SELECT MAX(DATE_ID) FROM DC_E_BTSG2_GSMSECTOR_RAW WHERE DATE_ID <= @dateDay)
)D1

ELSE 
SELECT
   D1."ELEMENT" AS "ELEMENT",
   D1."MOID" AS "MOID",
   D1."FEATURENAME" AS "FEATURENAME",
   D1."FEATURESTATE" AS "FEATURESTATE",
   D1."LICENSESTATE" AS "LICENSESTATE",
   D1."SERVICESTATE" AS "SERVICESTATE",
   D1."DATEID" AS "DATEID",
   D1."OSSID" AS "OSSID"
FROM (
        SELECT  
        FS.ELEMENT AS "ELEMENT",
        FS.MOID AS "MOID",
        FK.NAME AS "FEATURENAME", 
        CASE 
        WHEN FS.FEATURESTATE = 0 THEN 'Not Installed' 
        WHEN FS.FEATURESTATE = 1 THEN 'Installed' 
        END AS "FEATURESTATE", 
        CASE 
        WHEN FS.LICENSESTATE = 0 THEN 'Not Available' 
        WHEN FS.LICENSESTATE = 1 THEN 'Available' 
        END AS "LICENSESTATE", 
        CASE 
        WHEN FS.SERVICESTATE = 0 THEN 'Inactive' 
        WHEN FS.SERVICESTATE = 1 THEN 'Active' 
        END AS "SERVICESTATE", 
        FS.DATE_ID AS "DATEID",
        FS.OSS_ID AS "OSSID"
        FROM 
        DC_E_BULK_CM_FEATUREKEY_RAW FK,
        DC_E_BULK_CM_FEATURESTATE_RAW FS
        WHERE FK.KEYID = FS.KEYID
        AND FS.DATE_ID <= (SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_FEATURESTATE_RAW WHERE DATE_ID <= @dateDay)
        AND FS.DATE_ID >= (SELECT MIN(DATE_ID) FROM DC_E_BULK_CM_FEATURESTATE_RAW WHERE DATE_ID >= @date)
        AND FK.DATE_ID <= (SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_FEATUREKEY_RAW WHERE DATE_ID <= @dateDay)
        AND FK.DATE_ID >= (SELECT MIN(DATE_ID) FROM DC_E_BULK_CM_FEATUREKEY_RAW WHERE DATE_ID >= @date)
        AND FS.ELEMENT = FK.ELEMENT
        AND FS.DATE_ID = FK.DATE_ID
        AND FK.NAME IN (
        'LteAiPoweredMimoSleepMode',
        'NrDynamicPowerOptimizer',
        'NrServiceAdaptiveDrx',
        'CellSleepMode',
        'MIMOSleepMode',
        'MicroSleepTx',
        'LowEnergySchedulerSolution',
        'TrafficAwarePowerSave')
)D1

###############################################################################################################
Information Link Name:IL_DC_E_BULK_CM_FEATURESTATE_NODE_DOD
DECLARE @date DATE
SET @date = CAST(DATEADD(dd, -730, GETDATE()) AS DATE)
DECLARE @dateDay DATE
SET @dateDay = CAST(DATEADD(dd,-1,GETDATE()) AS DATE)

DECLARE @nodes VARCHAR(50)
SET @nodes = ''

IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_BTSG2_GSMSECTOR_RAW') > 0)
SET @nodes = @nodes + 'GSM'

IF(@nodes='GSM')
SELECT
   D1."ELEMENT" AS "ELEMENT",
   D1."MOID" AS "MOID",
   D1."FEATURENAME" AS "FEATURENAME",
   D1."FEATURESTATE" AS "FEATURESTATE",
   D1."LICENSESTATE" AS "LICENSESTATE",
   D1."SERVICESTATE" AS "SERVICESTATE",
   D1."DATEID" AS "DATEID",
   D1."OSSID" AS "OSSID"
FROM (
        SELECT  
        FS.ELEMENT AS "ELEMENT",
        FS.MOID AS "MOID",
        FK.NAME AS "FEATURENAME", 
        CASE 
        WHEN FS.FEATURESTATE = 0 THEN 'Not Installed' 
        WHEN FS.FEATURESTATE = 1 THEN 'Installed' 
        END AS "FEATURESTATE", 
        CASE 
        WHEN FS.LICENSESTATE = 0 THEN 'Not Available'
        WHEN FS.LICENSESTATE = 1 THEN 'Available'
        END AS "LICENSESTATE", 
        CASE 
        WHEN FS.SERVICESTATE = 0 THEN 'Inactive' 
        WHEN FS.SERVICESTATE = 1 THEN 'Active' 
        END AS "SERVICESTATE", 
        FS.DATE_ID AS "DATEID",
        FS.OSS_ID AS "OSSID"
        FROM 
        DC_E_BULK_CM_FEATUREKEY_RAW FK,
        DC_E_BULK_CM_FEATURESTATE_RAW FS
        WHERE FK.KEYID = FS.KEYID
        AND FS.DATE_ID <= (SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_FEATURESTATE_RAW WHERE DATE_ID <= @dateDay)
        AND FS.DATE_ID >= (SELECT MIN(DATE_ID) FROM DC_E_BULK_CM_FEATURESTATE_RAW WHERE DATE_ID >= @date)
        AND FK.DATE_ID <= (SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_FEATUREKEY_RAW WHERE DATE_ID <= @dateDay)
        AND FK.DATE_ID >= (SELECT MIN(DATE_ID) FROM DC_E_BULK_CM_FEATUREKEY_RAW WHERE DATE_ID >= @date)
        AND FS.ELEMENT = FK.ELEMENT
        AND FS.DATE_ID = FK.DATE_ID
        AND FK.NAME IN (
        'LteAiPoweredMimoSleepMode',
        'NrDynamicPowerOptimizer',
        'NrServiceAdaptiveDrx',
        'CellSleepMode',
        'MIMOSleepMode',
        'MicroSleepTx',
        'LowEnergySchedulerSolution',
        'TrafficAwarePowerSave')
        UNION
        SELECT 
        PS.ELEMENT AS "ELEMENT",
        PS.MOID AS "MOID",
        'MCPA Tx Power' AS "FEATURENAME",
        CASE 
        WHEN PS.mcpaPsWantedState = 0 THEN 'Not Installed'
        WHEN PS.mcpaPsWantedState = 1 THEN 'Installed'
        END AS "FEATURESTATE",
        CASE 
        WHEN PS.mcpaPsWantedState = 0 THEN 'Not Available'
        WHEN PS.mcpaPsWantedState = 1 THEN 'Available'
        END AS "LICENSESTATE",
        CASE 
        WHEN PS.mcpaPsWantedState = 0 THEN 'Inactive'
        WHEN PS.mcpaPsWantedState = 1 THEN 'Active'
        END AS "SERVICESTATE", 
        PS.DATE_ID AS "DATEID",
        PS.OSS_ID AS "OSSID"
        FROM DC_E_BULK_CM_POWERSAVINGS_RAW PS
        WHERE PS.DATE_ID <= (SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_POWERSAVINGS_RAW WHERE DATE_ID <= @dateDay)
        AND PS.DATE_ID >= (SELECT MIN(DATE_ID) FROM DC_E_BULK_CM_FEATUREKEY_RAW WHERE DATE_ID >= @date)
        UNION
        SELECT 
        PS.ELEMENT AS "ELEMENT",
        PS.MOID AS "MOID",
        'BCCH Power Savings' AS "FEATURENAME",
        CASE 
        WHEN PS.BCCHPS = 0 THEN 'Not Installed'
        WHEN PS.BCCHPS = 1 THEN 'Installed'
        END AS "FEATURESTATE",
        CASE 
        WHEN PS.BCCHPS = 0 THEN 'Not Available'
        WHEN PS.BCCHPS = 1 THEN 'Available'
        END AS "LICENSESTATE",
        CASE 
        WHEN PS.BCCHPS = 0 THEN 'Inactive'
        WHEN PS.BCCHPS = 1 THEN 'Active'
        END AS "SERVICESTATE",
        PS.DATE_ID AS "DATEID",
        PS.OSS_ID AS "OSSID"
        FROM DC_E_BULK_CM_POWERSAVINGS_RAW PS
        WHERE PS.DATE_ID <= (SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_POWERSAVINGS_RAW WHERE DATE_ID <= @dateDay)
        AND PS.DATE_ID >= (SELECT MIN(DATE_ID) FROM DC_E_BULK_CM_FEATUREKEY_RAW WHERE DATE_ID >= @date)
        UNION
        SELECT 
        DISTINCT GSM.BTS AS "ELEMENT",
        GSM.GsmSector AS "MOID",
        'Micro Sleep Tx GSM' AS "FEATURENAME",
        'Installed' AS "FEATURESTATE",
        'Available' AS "LICENSESTATE",
        'Active' AS "SERVICESTATE",
        GSM.DATE_ID AS "DATEID",
        GSM.OSS_ID AS "OSSID"
        FROM DC_E_BTSG2_GSMSECTOR_RAW GSM
        WHERE GSM.DATE_ID = (SELECT MAX(DATE_ID) FROM DC_E_BTSG2_GSMSECTOR_RAW WHERE DATE_ID <= @dateDay)
)D1

WHERE
<conditions>

ELSE 
SELECT
   D1."ELEMENT" AS "ELEMENT",
   D1."MOID" AS "MOID",
   D1."FEATURENAME" AS "FEATURENAME",
   D1."FEATURESTATE" AS "FEATURESTATE",
   D1."LICENSESTATE" AS "LICENSESTATE",
   D1."SERVICESTATE" AS "SERVICESTATE",
   D1."DATEID" AS "DATEID",
   D1."OSSID" AS "OSSID"
FROM (
        SELECT  
        FS.ELEMENT AS "ELEMENT",
        FS.MOID AS "MOID",
        FK.NAME AS "FEATURENAME", 
        CASE 
        WHEN FS.FEATURESTATE = 0 THEN 'Not Installed' 
        WHEN FS.FEATURESTATE = 1 THEN 'Installed' 
        END AS "FEATURESTATE", 
        CASE 
        WHEN FS.LICENSESTATE = 0 THEN 'Not Available' 
        WHEN FS.LICENSESTATE = 1 THEN 'Available' 
        END AS "LICENSESTATE", 
        CASE 
        WHEN FS.SERVICESTATE = 0 THEN 'Inactive' 
        WHEN FS.SERVICESTATE = 1 THEN 'Active' 
        END AS "SERVICESTATE", 
        FS.DATE_ID AS "DATEID",
        FS.OSS_ID AS "OSSID"
        FROM 
        DC_E_BULK_CM_FEATUREKEY_RAW FK,
        DC_E_BULK_CM_FEATURESTATE_RAW FS
        WHERE FK.KEYID = FS.KEYID
        AND FS.DATE_ID <= (SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_FEATURESTATE_RAW WHERE DATE_ID <= @dateDay)
        AND FS.DATE_ID >= (SELECT MIN(DATE_ID) FROM DC_E_BULK_CM_FEATURESTATE_RAW WHERE DATE_ID >= @date)
        AND FK.DATE_ID <= (SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_FEATUREKEY_RAW WHERE DATE_ID <= @dateDay)
        AND FK.DATE_ID >= (SELECT MIN(DATE_ID) FROM DC_E_BULK_CM_FEATUREKEY_RAW WHERE DATE_ID >= @date)
        AND FS.ELEMENT = FK.ELEMENT
        AND FS.DATE_ID = FK.DATE_ID
        AND FK.NAME IN (
        'LteAiPoweredMimoSleepMode',
        'NrDynamicPowerOptimizer',
        'NrServiceAdaptiveDrx',
        'CellSleepMode',
        'MIMOSleepMode',
        'MicroSleepTx',
        'LowEnergySchedulerSolution',
        'TrafficAwarePowerSave')
)D1
WHERE
<conditions>

###############################################################################################################
Information Link Name:IL_DC_BULK_CM_FILEDREPLACABLEUNIT_RAW_6_MONTHS
DECLARE @date DATE
SET @date = DATEADD(mm, -6, GETDATE())
DECLARE @dateDay DATE
SET @dateDay = CAST(getdate() AS DATE)
SELECT
   D1."DATE_ID" AS "DATEID",
   D1."ELEMENT" AS "ELEMENT",
   D1."MOID" AS "MOID",
   D1."OSS_ID" AS "OSSID",
   D1."productData_productName" AS "PRODUCTDATAPRODUCTNAME",
   D1."FieldReplaceableUnit" AS "FIELDREPLACEABLEUNIT"
FROM DC_E_BULK_CM_FIELDREPLACABLEUNIT_raw D1
WHERE
D1."DATE_ID" >= @date
AND D1."DATE_ID" < @dateDay
AND D1."productData_productName" != ''
AND <conditions>

###############################################################################################################
Information Link Name:IL_DC_BULK_CM_FILEDREPLACABLEUNIT_RAW_DOD
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

SELECT
D1."DATE_ID" AS "DATEID",
   D1."ELEMENT" AS "ELEMENT",
   D1."MOID" AS "MOID",
   D1."OSS_ID" AS "OSSID",
   D1."productData_productName" AS "PRODUCTDATAPRODUCTNAME",
   D1."FieldReplaceableUnit" AS "FIELDREPLACEABLEUNIT"
FROM DC_E_BULK_CM_FIELDREPLACABLEUNIT_raw D1
WHERE
D1."DATETIME_ID" >= @date
AND D1."DATETIME_ID" < @dateDay
AND D1."productData_productName" != ''
AND <conditions>


###############################################################################################################
Information Link Name:IL_DC_BULK_CM_swversion_RAW_6_MONTHS
DECLARE @date DATE
SET @date = DATEADD(mm, -6, GETDATE())
DECLARE @dateDay DATE
SET @dateDay = CAST(getdate() AS DATE)

SELECT DISTINCT
   D1."DATE_ID" AS "DATEID",
   D1."ELEMENT" AS "ELEMENT",
   D1."SwVersion" AS "SWVERSION",
   D1."swVersionId" AS "SWVERSIONID"
FROM
   "DC_E_BULK_CM_SWVERSION_RAW" D1
WHERE
D1."DATETIME_ID" >= @date
AND D1."DATETIME_ID" < @dateDay

###############################################################################################################
Information Link Name:IL_DC_BULK_CM_swversion_RAW_DOD
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

SELECT
D1."ELEMENT" AS "NODE",
D1."SwVersion" AS "SwVersion",
D1."swVersionId" AS "swVersionId",
D1."DATETIME_ID" AS "DATETIMEID",
 D1."DATE_ID" AS "DATEID"
FROM "DC_E_BULK_CM_SWVERSION_raw" D1
WHERE
D1."DATE_ID" >= @date AND D1."DATE_ID" < @dateDay
AND D1."swVersionId" != ''
AND <conditions>

###############################################################################################################
Information Link Name:IL_DC_E_BULK_CM_THRESHOLD
DECLARE @date DATE
SET @date = CAST(DATEADD(dd, -7, GETDATE()) AS DATE)
DECLARE @dateDay DATE
SET @dateDay = CAST(DATEADD(dd,-1,GETDATE()) AS DATE)

SELECT
   D1."ELEMENT" AS "ELEMENT",
   D1."Date_id" as "Date_id",
   D1."Nodetype" AS "Nodetype",
   D1."Threshold" AS "Threshold",
   D1."Threshold1" AS "Threshold1",
   D1."Threshold2" AS "Threshold2"
FROM(
(
SELECT element, DATE_ID, Nodetype, Threshold, max(Threshold1) as Threshold1, max(Threshold2) as Threshold2 FROM (
SELECT element, DATE_ID, '4G' as Nodetype, 'Low Energy Scheduler Solution' as Threshold, lessPrbUsageThreshold as Threshold1, null as Threshold2 
from DC_E_BULK_CM_EUTRANCELLFDD_RAW WHERE DATE_ID IN 
(SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_EUTRANCELLFDD_RAW
WHERE DATE_ID >= @date AND DATE_ID <= @dateDay)
UNION
SELECT element, DATE_ID, '4G' as Nodetype, 'Low Energy Scheduler Solution' as Threshold, lessPrbUsageThreshold as Threshold1, null as Threshold2 
from DC_E_BULK_CM_EUTRANCELLTDD_RAW WHERE DATE_ID IN 
(SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_EUTRANCELLTDD_RAW
WHERE DATE_ID >= @date AND DATE_ID <= @dateDay)
UNION
SELECT element, DATE_ID, '4G' as Nodetype,  'Low Energy Scheduler Solution' as Threshold, null as Threshold1, lessMaxDelayThreshold as Threshold2 
from DC_E_BULK_CM_QCIPROFILEOPERATORDEFINED_RAW WHERE DATE_ID IN 
(SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_QCIPROFILEOPERATORDEFINED_RAW
WHERE DATE_ID >= @date AND DATE_ID <= @dateDay)
UNION
SELECT element, DATE_ID, '4G' as Nodetype,  'Low Energy Scheduler Solution' as Threshold, null as Threshold1, lessMaxDelayThreshold as Threshold2 
from DC_E_BULK_CM_QCIPROFILEPREDEFINED_RAW WHERE DATE_ID IN 
(SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_QCIPROFILEPREDEFINED_RAW
WHERE DATE_ID >= @date AND DATE_ID <= @dateDay)
UNION
SELECT element, DATE_ID, '4G' as Nodetype,  'Low Energy Scheduler Solution' as Threshold, null as Threshold1, lessMaxDelayThreshold as Threshold2 
from DC_E_BULK_CM_SCIPROFILE_RAW WHERE DATE_ID IN 
(SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_SCIPROFILE_RAW
WHERE DATE_ID >= @date AND DATE_ID <= @dateDay)
)D2
GROUP BY element, DATE_ID, nodetype, threshold)
UNION
SELECT element, DATE_ID, '4G' as Nodetype, 'MIMO Sleep Down' as Threshold, switchDownPrbThreshold as Threshold1, switchDownRrcConnThreshold as Threshold2
FROM DC_E_BULK_CM_MIMOSLEEPFUNCTION_RAW WHERE DATE_ID IN (SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_MIMOSLEEPFUNCTION_RAW
WHERE DATE_ID >= @date AND DATE_ID <= @dateDay)
UNION
SELECT element, DATE_ID, '4G' as Nodetype, 'MIMO Sleep Up' as Threshold, switchUpPrbThreshold as Threshold1, switchUpRrcConnThreshold as Threshold2
FROM DC_E_BULK_CM_MIMOSLEEPFUNCTION_RAW WHERE DATE_ID IN (SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_MIMOSLEEPFUNCTION_RAW
WHERE DATE_ID >= @date AND DATE_ID <= @dateDay)
UNION
(
SELECT element, DATE_ID, Nodetype, Threshold, max(Threshold1) as Threshold1, max(Threshold2) as Threshold2 FROM (
SELECT element, DATE_ID, '3G' as Nodetype, 'Traffic Aware Power Save' as Threshold, tpsCellThresholds_tpsLockThreshold as Threshold1, tpsCellThresholds_tpsUnlockThreshold as Threshold2
FROM DC_E_BULK_CM_UTRANCELL_RAW WHERE DATE_ID IN (SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_UTRANCELL_RAW
WHERE DATE_ID >= @date AND DATE_ID <= @dateDay)
UNION
SELECT element, DATE_ID, '3G' as Nodetype, 'Traffic Aware Power Save' as Threshold, tpsLockThreshold as Threshold1, tpsUnlockThreshold as Threshold2 
FROM DC_E_BULK_CM_TRAFFICAWAREPOWSAVE_RAW WHERE DATE_ID IN (SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_TRAFFICAWAREPOWSAVE_RAW 
WHERE DATE_ID >= @date AND DATE_ID <= @dateDay)
)D3
GROUP BY element, DATE_ID, nodetype, threshold)
)D1
WHERE
   <conditions>
   

###############################################################################################################
Information Link Name:IL_DC_E_BULK_CM_THRESHOLD_NODE_DOD

DECLARE @date DATE
SET @date = CAST(DATEADD(dd, -730, GETDATE()) AS DATE)
DECLARE @dateDay DATE
SET @dateDay = CAST(DATEADD(dd,-1,GETDATE()) AS DATE)
SELECT
   D1."ELEMENT" AS "ELEMENT",
   D1."Nodetype" AS "Nodetype",
   D1."Threshold" AS "Threshold",
   D1."Threshold1" AS "Threshold1",
   D1."Threshold2" AS "Threshold2",
   D1."DATE_ID" AS "DATE_ID"
FROM(
(
SELECT element, Nodetype, Threshold, max(Threshold1) as Threshold1, max(Threshold2) as Threshold2, DATE_ID FROM (
SELECT element, '4G' as Nodetype, 'Low Energy Scheduler Solution' as Threshold, lessPrbUsageThreshold as Threshold1, null as Threshold2, DATE_ID 
from DC_E_BULK_CM_EUTRANCELLFDD_RAW WHERE DATE_ID IN 
(SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_EUTRANCELLFDD_RAW
WHERE DATE_ID >= @date AND DATE_ID <= @dateDay)
UNION
SELECT element, '4G' as Nodetype, 'Low Energy Scheduler Solution' as Threshold, lessPrbUsageThreshold as Threshold1, null as Threshold2, DATE_ID 
from DC_E_BULK_CM_EUTRANCELLTDD_RAW WHERE DATE_ID IN 
(SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_EUTRANCELLTDD_RAW
WHERE DATE_ID >= @date AND DATE_ID <= @dateDay)
UNION
SELECT element, '4G' as Nodetype,  'Low Energy Scheduler Solution' as Threshold, null as Threshold1, lessMaxDelayThreshold as Threshold2, DATE_ID 
from DC_E_BULK_CM_QCIPROFILEOPERATORDEFINED_RAW WHERE DATE_ID IN 
(SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_QCIPROFILEOPERATORDEFINED_RAW
WHERE DATE_ID >= @date AND DATE_ID <= @dateDay)
UNION
SELECT element, '4G' as Nodetype,  'Low Energy Scheduler Solution' as Threshold, null as Threshold1, lessMaxDelayThreshold as Threshold2, DATE_ID 
from DC_E_BULK_CM_QCIPROFILEPREDEFINED_RAW WHERE DATE_ID IN 
(SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_QCIPROFILEPREDEFINED_RAW
WHERE DATE_ID >= @date AND DATE_ID <= @dateDay)
UNION
SELECT element, '4G' as Nodetype,  'Low Energy Scheduler Solution' as Threshold, null as Threshold1, lessMaxDelayThreshold as Threshold2, DATE_ID 
from DC_E_BULK_CM_SCIPROFILE_RAW WHERE DATE_ID IN 
(SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_SCIPROFILE_RAW
WHERE DATE_ID >= @date AND DATE_ID <= @dateDay)
)D2
GROUP BY element, nodetype, threshold, DATE_ID)
UNION
SELECT element, '4G' as Nodetype, 'MIMO Sleep Down' as Threshold, switchDownPrbThreshold as Threshold1, switchDownRrcConnThreshold as Threshold2, DATE_ID
FROM DC_E_BULK_CM_MIMOSLEEPFUNCTION_RAW WHERE DATE_ID IN (SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_MIMOSLEEPFUNCTION_RAW
WHERE DATE_ID >= @date AND DATE_ID <= @dateDay)
UNION
SELECT element, '4G' as Nodetype, 'MIMO Sleep Up' as Threshold, switchUpPrbThreshold as Threshold1, switchUpRrcConnThreshold as Threshold2, DATE_ID
FROM DC_E_BULK_CM_MIMOSLEEPFUNCTION_RAW WHERE DATE_ID IN (SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_MIMOSLEEPFUNCTION_RAW
WHERE DATE_ID >= @date AND DATE_ID <= @dateDay)
UNION
(
SELECT element, Nodetype, Threshold, max(Threshold1) as Threshold1, max(Threshold2) as Threshold2, DATE_ID FROM (
SELECT element, '3G' as Nodetype, 'Traffic Aware Power Save' as Threshold, tpsCellThresholds_tpsLockThreshold as Threshold1, tpsCellThresholds_tpsUnlockThreshold as Threshold2, DATE_ID
FROM DC_E_BULK_CM_UTRANCELL_RAW WHERE DATE_ID IN (SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_UTRANCELL_RAW
WHERE DATE_ID >= @date AND DATE_ID <= @dateDay)
UNION
SELECT element, '3G' as Nodetype, 'Traffic Aware Power Save' as Threshold, tpsLockThreshold as Threshold1, tpsUnlockThreshold as Threshold2, DATE_ID 
FROM DC_E_BULK_CM_TRAFFICAWAREPOWSAVE_RAW WHERE DATE_ID IN (SELECT MAX(DATE_ID) FROM DC_E_BULK_CM_TRAFFICAWAREPOWSAVE_RAW 
WHERE DATE_ID >= @date AND DATE_ID <= @dateDay)
)D3
GROUP BY element, nodetype, threshold, DATE_ID)
)D1
WHERE
   <conditions>

###############################################################################################################
Information Link Name:IL_DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY
DECLARE @date DATE
SET @date = dateadd(mm, -6, getdate())
DECLARE @dateDay DATE
SET @dateDay = CAST(getdate() AS DATE)

SELECT
	CASE 
		WHEN D1.ERBS <> '' AND ERBS IS NOT NULL THEN '4G' 
		WHEN D1.RBS <> '' AND RBS IS NOT NULL THEN '3G' 
	END AS "ROWSTATUS",
   D1."DATE_ID" AS "DATEID",
   CASE 
		WHEN D1.ERBS <> '' AND ERBS IS NOT NULL THEN ERBS 
		WHEN D1.RBS <> '' AND RBS IS NOT NULL THEN RBS
	END AS "ERBS",
   SUM(D1."pmConsumedEnergy") AS "PMCONSUMEDENERGY",
   SUM(D1."pmConsumedEnergyAccumulated") AS "PMCONSUMEDENERGYACCUMULATED"
FROM
   "DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY" D1
WHERE
D1."DATE_ID" >= @date AND D1."DATE_ID" < @dateDay 
AND D1."ROWSTATUS" = 'AGGREGATED'
GROUP BY 
D1."DATE_ID",
D1."ERBS",
D1."RBS"
   

###############################################################################################################
Information Link Name:IL_DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY_DOD

DECLARE @date DATE
SET @date = dateadd(mm, -6, getdate())
DECLARE @dateDay DATE
SET @dateDay = CAST(getdate() AS DATE)

SELECT
   D1."ERBS",
   D1."NODETYPE",  
   D1."DATE_ID",
   D1."MOID",
   D1."OSSID",
   D1."DATACOVERAGE",
   D1."pmConsumedEnergy",
   D1."pmConsumedEnergyAccumulated"
   
FROM
   (SELECT 
	   CASE 
			WHEN D2.ERBS <> '' AND ERBS IS NOT NULL THEN ERBS 
			WHEN D2.RBS <> '' AND RBS IS NOT NULL THEN RBS
	   END AS ERBS,
	   CASE 
			WHEN D2.ERBS <> '' AND ERBS IS NOT NULL THEN '4G' 
			WHEN D2.RBS <> '' AND RBS IS NOT NULL THEN '3G' 
	   END AS NODETYPE,
	   D2.DATE_ID AS DATE_ID,
	   D2.MOID AS MOID,
	   D2.OSS_ID AS OSSID,
	   D2.DATACOVERAGE AS DATACOVERAGE,
	   D2.pmConsumedEnergy AS PMCONSUMEDENERGY,
	   D2.pmConsumedEnergyAccumulated AS PMCONSUMEDENERGYACCUMULATED
	FROM (
        SELECT
			ERBS,
			RBS,  
			DATE_ID,
			MOID,
			OSS_ID,
			DATACOVERAGE,
			pmConsumedEnergy,
			pmConsumedEnergyAccumulated
        FROM
			DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY  ) D2
			WHERE
            D2."DATE_ID" >= @date 
			
			
	) D1
WHERE
D1."DATE_ID" >= @date  
AND <conditions>

###############################################################################################################
Information Link Name:IL_DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DOD
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

SELECT
   D1."ERBS",
   D1."NODETYPE",
   D1."DATETIME_ID",
   D1."MOID",
   D1."OSSID",
   D1."pmConsumedEnergy",
   D1."pmConsumedEnergyAccumulated"
FROM
   (
      SELECT
         CASE WHEN D2.ERBS <> ''
         AND ERBS IS NOT NULL THEN ERBS WHEN D2.RBS <> ''
         AND RBS IS NOT NULL THEN RBS END AS ERBS,
         CASE WHEN D2.ERBS <> ''
         AND ERBS IS NOT NULL THEN '4G' WHEN D2.RBS <> ''
         AND RBS IS NOT NULL THEN '3G' END AS NODETYPE,
         D2.DATETIME_ID AS DATETIME_ID,
         D2.MOID AS MOID,
         D2.OSS_ID AS OSSID,
         D2.pmConsumedEnergy AS PMCONSUMEDENERGY,
         D2.pmConsumedEnergyAccumulated AS PMCONSUMEDENERGYACCUMULATED
      FROM
         (
            SELECT
               ERBS,
               RBS,
               DATETIME_ID,
               MOID,
               OSS_ID,
               pmConsumedEnergy,
               pmConsumedEnergyAccumulated
            FROM
               DC_E_CPP_CONSUMEDENERGYMEASUREMENT_RAW
         ) D2
   ) D1
WHERE
   D1."DATETIME_ID" >= @date
   AND D1."DATETIME_ID" < @dateDay
   AND <conditions>

###############################################################################################################
Information Link Name:IL_DC_E_CPP_CONSUMEDENERGYMEASUREMENT_EU_DAY
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

SELECT
   D1."DATE_ID" ,
   D1."ERBS",
   D1."NODETYPE",  
   D1."OSSID",
   D1."pmConsumedEnergy",
   D1."pmConsumedEnergyAccumulated"
  
FROM
   (SELECT 
	   CASE 
			WHEN D2.ERBS <> '' AND ERBS IS NOT NULL THEN ERBS 
			WHEN D2.RBS <> '' AND RBS IS NOT NULL THEN RBS
	   END AS ERBS,
	   CASE 
			WHEN D2.ERBS <> '' AND ERBS IS NOT NULL THEN '4G' 
			WHEN D2.RBS <> '' AND RBS IS NOT NULL THEN '3G' 
	   END AS NODETYPE,
	   D2.DATE_ID AS DATE_ID,
	   D2.OSS_ID AS OSSID,
	   D2.pmConsumedEnergy AS PMCONSUMEDENERGY,
	   D2.pmConsumedEnergyAccumulated AS PMCONSUMEDENERGYACCUMULATED
	FROM (
        SELECT
			ERBS,
			RBS,  
			DATE_ID,
			OSS_ID,
			pmConsumedEnergy,
			pmConsumedEnergyAccumulated
        FROM
			DC_E_CPP_CONSUMEDENERGYMEASUREMENT_DAY  ) D2
			WHERE
            D2."DATE_ID" >= @date 
	) D1
WHERE
D1."DATE_ID" >= @date  

###############################################################################################################
Information Link Name:IL_DC_E_CPP_ENERGYMETER_DAY
DECLARE @date DATE
SET @date = DATEADD(mm, -6, GETDATE())
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

SELECT
   D1."ERBS" AS "ERBS",
   D1."DATE_ID" AS "DATEID",
   D1."MOID" AS "MOID",
   D1."OSS_ID" AS "OSSID",
   D1."pmConsumedEnergy" AS "PMCONSUMEDENERGY",
   D1."pmConsumedEnergyAccumulated" AS "PMCONSUMEDENERGYACCUMULATED"
FROM
    "DC_E_CPP_ENERGYMETER_DAY" D1
WHERE
    D1."DATE_ID" >= @date AND D1."DATE_ID" < @dateDay
    AND D1."ROWSTATUS" = 'AGGREGATED' 

###############################################################################################################
Information Link Name:IL_DC_E_CPP_ENERGYMETER_DOD
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

SELECT
   D1."ERBS" AS "ERBS",
   D1."DATETIME_ID" AS "DATETIMEID",
   D1."DATE_ID" AS "DATEID",
   D1."MOID" AS "MOID",
   D1."OSS_ID" AS "OSSID",
   D1."pmConsumedEnergy" AS "PMCONSUMEDENERGY",
   D1."pmConsumedEnergyAccumulated" AS "PMCONSUMEDENERGYACCUMULATED"
FROM
   DC_E_CPP_ENERGYMETER_RAW D1
WHERE
   D1."DATETIME_ID" >= @date
AND 
   D1."DATETIME_ID" < @dateDay
AND
<conditions>

###############################################################################################################
Information Link Name:IL_DC_E_DATA_THROUGHPUT_GSM_DAY
DECLARE @date DATE
SET @date = DATEADD(mm, -6, GETDATE())
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)
IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_BSS_CELL_PS_DAY') > 0 )
SELECT
	D1."DATE_ID" AS "DATEID",
	D1."BSC" AS "BSC",
	SUM(CELLGPRS3_DLSTRVOL + CELLGPRS3_DLINTBGVOL) as DataVolumeDown,
	SUM(CELLQOSS_VOLULSTRACC + CELLGPRS3_ULINTBGVOL + CELLEIT2_LLCVOLULEIT + CLDTMQOS_DTMULSTRDATA) as DataVolumeUp,
	'2G' AS "MOID"
FROM
		DC_E_BSS_CELL_PS_DAY D1
INNER JOIN DIM_E_GRAN_RADIONODE_TRX trx ON
		D1.CELL_NAME = trx.GSMSECTOR
INNER JOIN DIM_E_GRAN_RADIONODE rn ON
		trx.RADIONODE = rn.RADIONODE_NAME
WHERE
		D1."DATE_ID" >= @date
	AND D1."DATE_ID" < @dateDay
	GROUP BY D1.DATE_ID, D1."BSC"
ELSE
SELECT
	NULL AS "DATE_ID", 
 	NULL AS "DataVolumeDown", 
 	NULL AS "DataVolumeUp", 
 	NULL AS "NODE_TYPE"

###############################################################################################################
Information Link Name:IL_DC_E_DATA_THROUGHPUT_GSM_EU_DAY
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_BSS_CELL_PS_DAY') > 0 )
SELECT
 D1."DATE_ID" AS "DATEID",
 D1."BSC" AS "BSC",
 D1."OSS_ID" AS "OSSID",
 SUM(D1."CELLGPRS3_DLSTRVOL" + D1."CELLGPRS3_DLINTBGVOL") as "DataVolumeDown",
 SUM(D1."CELLQOSS_VOLULSTRACC" + D1."CELLGPRS3_ULINTBGVOL" + D1."CELLEIT2_LLCVOLULEIT" + D1."CLDTMQOS_DTMULSTRDATA") as "DataVolumeUp",
 '2G' AS "NODE_TYPE"
FROM
	DC_E_BSS_CELL_PS_DAY D1
INNER JOIN DIM_E_GRAN_RADIONODE_TRX trx ON
	D1."CELL_NAME" = trx.GSMSECTOR
INNER JOIN DIM_E_GRAN_RADIONODE rn ON
	trx.RADIONODE = rn.RADIONODE_NAME
WHERE
	D1."DATE_ID" >= @date AND 
	D1."DATE_ID" < @dateDay
GROUP BY
D1."DATE_ID",
D1."BSC",
D1."OSS_ID"

###############################################################################################################
Information Link Name:IL_DC_E_DATA_THROUGHPUT_GSM_RAW_DOD
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_BSS_CELL_PS_RAW') > 0 )
SELECT
  D1."BSC" AS "BSC",
  D1."OSS_ID" AS "OSSID",
  D1."DATETIME_ID" AS "DATETIMEID",
 SUM(D1."CELLGPRS3_DLSTRVOL" + D1."CELLGPRS3_DLINTBGVOL") as "DataVolumeDown",
 SUM(D1."CELLQOSS_VOLULSTRACC" + D1."CELLGPRS3_ULINTBGVOL" + D1."CELLEIT2_LLCVOLULEIT" + D1."CLDTMQOS_DTMULSTRDATA") as "DataVolumeUp",
 '2G' AS "NODE_TYPE"
FROM
	DC_E_BSS_CELL_PS_RAW D1
INNER JOIN DIM_E_GRAN_RADIONODE_TRX trx ON
	D1."CELL_NAME" = trx.GSMSECTOR
INNER JOIN DIM_E_GRAN_RADIONODE rn ON
	trx.RADIONODE = rn.RADIONODE_NAME
WHERE
	D1."DATETIME_ID" >= @date AND 
	D1."DATETIME_ID"< @dateDay AND
                <conditions>
GROUP BY
D1."DATETIME_ID",
D1."BSC",
D1."OSS_ID"

###############################################################################################################
Information Link Name:IL_DC_E_DATA_THROUGHPUT_LTE_DAY
DECLARE @date DATE
SET @date = DATEADD(mm, -6, GETDATE())
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)
IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_ERBS_EUTRANCELLFDD_DAY') > 0 )
SELECT 
 DATE_ID,
 ERBS,
 SUM(pmPdcpVolDlDrb) AS DataVolumeDown, 
 SUM(pmPdcpVolUlDrb) AS DataVolumeUp, 
 '4G' AS "MOID"
 FROM (
  SELECT  
   DATE_ID,
   ERBS,
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLFDD_DAY
   WHERE DATE_ID >= @date AND DATE_ID < @dateDay 
  UNION ALL
  SELECT 
   DATE_ID,
   ERBS,
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLTDD_DAY
   WHERE DATE_ID >= @date AND DATE_ID < @dateDay
)pmPdcpVol 
GROUP BY DATE_ID,ERBS
ELSE
SELECT
	NULL AS "DATE_ID", 
 	NULL AS "DataVolumeDown", 
 	NULL AS "DataVolumeUp", 
 	NULL AS "NODE_TYPE"
	
###############################################################################################################
Information Link Name:IL_DC_E_DATA_THROUGHPUT_LTE_EU_DAY
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_ERBS_EUTRANCELLFDD_DAY') > 0 )
SELECT 
 D1."DATE_ID" AS "DATEID", 
 D1."ERBS" AS "ERBS",
 D1."OSS_ID" AS "OSSID",
 SUM(D1."pmPdcpVolDlDrb") AS "DataVolumeDown", 
 SUM(D1."pmPdcpVolUlDrb") AS "DataVolumeUp",
 '4G' AS "NODE_TYPE"
 FROM (
  SELECT  
   DATE_ID, 
   ERBS,
   OSS_ID,
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLFDD_DAY
   WHERE DATE_ID >= @date AND DATE_ID < @dateDay 
  UNION ALL
  SELECT 
   DATE_ID, 
   ERBS,
   OSS_ID,
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLTDD_DAY
   WHERE DATE_ID >= @date AND DATE_ID < @dateDay
)D1 
GROUP BY 
D1."DATE_ID",
D1."ERBS",
D1."OSS_ID"
	
###############################################################################################################
Information Link Name:IL_DC_E_DATA_THROUGHPUT_LTE_RAW_DOD
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_ERBS_EUTRANCELLFDD_RAW') > 0 )
SELECT 
   D1."ERBS" AS "ERBS",
   D1."OSS_ID" AS "OSSID",
   D1."DATETIME_ID" AS "DATETIMEID",
 SUM(D1."pmPdcpVolDlDrb") AS "DataVolumeDown", 
 SUM(D1."pmPdcpVolUlDrb") AS "DataVolumeUp",
 '4G' AS "NODE_TYPE"
 FROM (
  SELECT  
   DATETIME_ID, 
   ERBS,
   OSS_ID,
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLFDD_RAW
   WHERE DATETIME_ID >= @date AND DATETIME_ID < @dateDay 
  UNION ALL
  SELECT 
   DATETIME_ID, 
   ERBS,
   OSS_ID,
   pmPdcpVolDlDrb, 
   pmPdcpVolUlDrb
   FROM DC_E_ERBS_EUTRANCELLTDD_RAW
   WHERE DATETIME_ID >= @date AND DATETIME_ID < @dateDay
)D1 
WHERE
   <conditions>
GROUP BY 
D1."DATETIME_ID",
D1."ERBS",
D1."OSS_ID"

###############################################################################################################
Information Link Name:IL_DC_E_DATA_THROUGHPUT_NR_DAY
DECLARE @date DATE
SET @date = DATEADD(mm, -6, GETDATE())
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)
IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_NR_NRCELLDU_DAY') > 0 )
SELECT
DATE_ID,
NR_NAME,
SUM(0.008*pmMacVolDl) AS DataVolumeDown,
SUM(0.008*pmMacVolUl) AS DataVolumeUp,
'5G' AS NODE_TYPE
FROM DC_E_NR_NRCELLDU_DAY
WHERE DATE_ID >= @date AND DATE_ID < @dateDay 
GROUP BY DATE_ID,NR_NAME
ELSE
SELECT
	NULL AS "DATE_ID", 
 	NULL AS "DataVolumeDown", 
 	NULL AS "DataVolumeUp", 
 	NULL AS "NODE_TYPE"	
###############################################################################################################
Information Link Name:IL_DC_E_DATA_THROUGHPUT_NR_EU_DAY
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_NR_NRCELLDU_DAY') > 0 )
SELECT
   D1."DATE_ID" AS "DATEID",
   D1."NR_NAME" AS "NRNAME",
   D1."OSS_ID" AS "OSSID",
   SUM(0.008*D1."pmMacVolDl") AS "DataVolumeDown",
   SUM(0.008*D1."pmMacVolUl") AS "DataVolumeUp",
   '5G' AS "NODE_TYPE"
FROM
   DC_E_NR_NRCELLDU_DAY D1
WHERE
   D1."DATE_ID" >= @date
   AND D1."DATE_ID" < @dateDay
GROUP BY
   D1."DATE_ID",
   D1."NR_NAME",
   D1."OSS_ID"
###############################################################################################################
Information Link Name:IL_DC_E_DATA_THROUGHPUT_NR_RAW_DOD
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_NR_NRCELLDU_RAW') > 0 )
SELECT
   D1."NR_NAME" AS "NRNAME",
   D1."OSS_ID" AS "OSSID",
   D1."DATETIME_ID" AS "DATETIMEID",
   SUM(0.008*D1."pmMacVolDl") AS "DataVolumeDown",
   SUM(0.008*D1."pmMacVolUl") AS "DataVolumeUp",
   '5G' AS "NODE_TYPE"
FROM
   DC_E_NR_NRCELLDU_RAW D1
WHERE
   D1."DATETIME_ID" >= @date
   AND D1."DATETIME_ID" < @dateDay
   AND <conditions>
GROUP BY
   D1."DATETIME_ID",
   D1."NR_NAME",
   D1."OSS_ID"

###############################################################################################################
Information Link Name:IL_DC_E_DATA_THROUGHPUT_WCDMA_DAY
DECLARE @date DATE
SET @date = DATEADD(mm, -6, GETDATE())
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)
IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_RAN_UCELL_DAY') > 0 )
SELECT 
 ran.DATE_ID, 
 ran.RNC,
  SUM(pmDlTrafficVolumeAmr4750 
 + pmDlTrafficVolumeAmr5900 
 + pmDlTrafficVolumeAmr7950 
 + pmDlTrafficVolumeAmrNbMm 
 + pmDlTrafficVolumeAmrWb 
 + pmDlTrafficVolumeCs12 
 + pmDlTrafficVolumeCs57 
 + pmDlTrafficVolumeCs64 
 + pmDlTrafficVolumePs128 
 + pmDlTrafficVolumePs16 
 + pmDlTrafficVolumePs384 
 + pmDlTrafficVolumePs64 
 + pmDlTrafficVolumePs8 
 + pmDlTrafficVolumePsCommon 
 + pmDlTrafficVolumePsIntHs 
 + pmDlTrafficVolumePsStr128 
 + pmDlTrafficVolumePsStr16 
 + pmDlTrafficVolumePsStr64 
 + pmDlTrafficVolumePsStrHs 
 + pmDlTrafficVolumeSrb136 
 + pmDlTrafficVolumeSrb34 
 + pmDlTrafficVolumeSrbOnlyHs)
  AS DataVolumeDown, 
   SUM(pmUlTrafficVolumeAmr4750 
 + pmUlTrafficVolumeAmr5900 
 + pmUlTrafficVolumeAmr7950 
 + pmUlTrafficVolumeAmrNbMm 
 + pmUlTrafficVolumeAmrWb 
 + pmUlTrafficVolumeCs12 
 + pmUlTrafficVolumeCs57 
 + pmUlTrafficVolumeCs64 
 + pmUlTrafficVolumePs128 
 + pmUlTrafficVolumePs16 
 + pmUlTrafficVolumePs384 
 + pmUlTrafficVolumePs64 
 + pmUlTrafficVolumePs8 
 + pmUlTrafficVolumePsCommon 
 + pmUlTrafficVolumePsIntEul 
 + pmUlTrafficVolumePsIntEulFach 
 + pmUlTrafficVolumePsStr128 
 + pmUlTrafficVolumePsStr16 
 + pmUlTrafficVolumePsStr32 
 + pmUlTrafficVolumeSrb136 
 + pmUlTrafficVolumeSrb34 
 + pmUlTrafficVolumeSrbOnlyEul)
 AS DataVolumeUp, 
'3G' AS NODE_TYPE
FROM DC_E_RAN_UCELL_DAY ran
INNER JOIN DIM_E_RAN_RBS dim_rbs ON dim_rbs.AssociatedRncName = ran.RNC
INNER JOIN DIM_E_RAN_UCELL dim_ucell ON dim_ucell.UCELL_NAME = ran.UtranCell AND dim_ucell.RBS_ID = dim_rbs.RBS_NAME
WHERE ran.DATE_ID >= @date AND ran.DATE_ID < @dateDay
GROUP BY ran.DATE_ID,ran.RNC
ELSE
SELECT
	NULL AS "DATE_ID", 
 	NULL AS "DataVolumeDown", 
 	NULL AS "DataVolumeUp", 
 	NULL AS "NODE_TYPE"
###############################################################################################################
Information Link Name:IL_DC_E_DATA_THROUGHPUT_WCDMA_EU_DAY
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_RAN_UCELL_DAY') > 0 )
SELECT 
 D1."DATE_ID" AS "DATEID",
 D1."RNC" AS "RNC",
 D1."OSS_ID" AS "OSSID",
  SUM(D1."pmDlTrafficVolumeAmr4750"
 + D1."pmDlTrafficVolumeAmr5900" 
 + D1."pmDlTrafficVolumeAmr7950" 
 + D1."pmDlTrafficVolumeAmrNbMm" 
 + D1."pmDlTrafficVolumeAmrWb" 
 + D1."pmDlTrafficVolumeCs12" 
 + D1."pmDlTrafficVolumeCs57" 
 + D1."pmDlTrafficVolumeCs64" 
 + D1."pmDlTrafficVolumePs128" 
 + D1."pmDlTrafficVolumePs16" 
 + D1."pmDlTrafficVolumePs384" 
 + D1."pmDlTrafficVolumePs64" 
 + D1."pmDlTrafficVolumePs8" 
 + D1."pmDlTrafficVolumePsCommon" 
 + D1."pmDlTrafficVolumePsIntHs" 
 + D1."pmDlTrafficVolumePsStr128" 
 + D1."pmDlTrafficVolumePsStr16" 
 + D1."pmDlTrafficVolumePsStr64" 
 + D1."pmDlTrafficVolumePsStrHs" 
 + D1."pmDlTrafficVolumeSrb136" 
 + D1."pmDlTrafficVolumeSrb34" 
 + D1."pmDlTrafficVolumeSrbOnlyHs")
  AS "DataVolumeDown", 
   SUM(D1."pmUlTrafficVolumeAmr4750" 
 + D1."pmUlTrafficVolumeAmr5900" 
 + D1."pmUlTrafficVolumeAmr7950" 
 + D1."pmUlTrafficVolumeAmrNbMm" 
 + D1."pmUlTrafficVolumeAmrWb" 
 + D1."pmUlTrafficVolumeCs12" 
 + D1."pmUlTrafficVolumeCs57" 
 + D1."pmUlTrafficVolumeCs64" 
 + D1."pmUlTrafficVolumePs128" 
 + D1."pmUlTrafficVolumePs16" 
 + D1."pmUlTrafficVolumePs384" 
 + D1."pmUlTrafficVolumePs64" 
 + D1."pmUlTrafficVolumePs8" 
 + D1."pmUlTrafficVolumePsCommon" 
 + D1."pmUlTrafficVolumePsIntEul" 
 + D1."pmUlTrafficVolumePsIntEulFach" 
 + D1."pmUlTrafficVolumePsStr128" 
 + D1."pmUlTrafficVolumePsStr16" 
 + D1."pmUlTrafficVolumePsStr32" 
 + D1."pmUlTrafficVolumeSrb136" 
 + D1."pmUlTrafficVolumeSrb34" 
 + D1."pmUlTrafficVolumeSrbOnlyEul")
 AS "DataVolumeUp", 
'3G' AS "NODE_TYPE"
FROM DC_E_RAN_UCELL_DAY D1
INNER JOIN DIM_E_RAN_RBS dim_rbs ON dim_rbs.AssociatedRncName = D1."RNC"
INNER JOIN DIM_E_RAN_UCELL dim_ucell ON dim_ucell.UCELL_NAME = D1."UtranCell" AND dim_ucell.RBS_ID = dim_rbs.RBS_NAME
WHERE D1."DATE_ID" >= @date AND D1."DATE_ID" < @dateDay
GROUP BY 
D1."DATE_ID",
D1."RNC",
D1."OSS_ID"

###############################################################################################################
Information Link Name:IL_DC_E_DATA_THROUGHPUT_WCDMA_RAW_DOD
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_RAN_UCELL_RAW') > 0 )
SELECT 
   D1."RNC" AS "RNC",
   D1."OSS_ID" AS "OSSID",
   D1."DATETIME_ID" AS "DATETIMEID",
  SUM(D1."pmDlTrafficVolumeAmr4750"
 + D1."pmDlTrafficVolumeAmr5900" 
 + D1."pmDlTrafficVolumeAmr7950" 
 + D1."pmDlTrafficVolumeAmrNbMm" 
 + D1."pmDlTrafficVolumeAmrWb" 
 + D1."pmDlTrafficVolumeCs12" 
 + D1."pmDlTrafficVolumeCs57" 
 + D1."pmDlTrafficVolumeCs64" 
 + D1."pmDlTrafficVolumePs128" 
 + D1."pmDlTrafficVolumePs16" 
 + D1."pmDlTrafficVolumePs384" 
 + D1."pmDlTrafficVolumePs64" 
 + D1."pmDlTrafficVolumePs8" 
 + D1."pmDlTrafficVolumePsCommon" 
 + D1."pmDlTrafficVolumePsIntHs" 
 + D1."pmDlTrafficVolumePsStr128" 
 + D1."pmDlTrafficVolumePsStr16" 
 + D1."pmDlTrafficVolumePsStr64" 
 + D1."pmDlTrafficVolumePsStrHs" 
 + D1."pmDlTrafficVolumeSrb136" 
 + D1."pmDlTrafficVolumeSrb34" 
 + D1."pmDlTrafficVolumeSrbOnlyHs")
  AS "DataVolumeDown", 
   SUM(D1."pmUlTrafficVolumeAmr4750" 
 + D1."pmUlTrafficVolumeAmr5900" 
 + D1."pmUlTrafficVolumeAmr7950" 
 + D1."pmUlTrafficVolumeAmrNbMm" 
 + D1."pmUlTrafficVolumeAmrWb" 
 + D1."pmUlTrafficVolumeCs12" 
 + D1."pmUlTrafficVolumeCs57" 
 + D1."pmUlTrafficVolumeCs64" 
 + D1."pmUlTrafficVolumePs128" 
 + D1."pmUlTrafficVolumePs16" 
 + D1."pmUlTrafficVolumePs384" 
 + D1."pmUlTrafficVolumePs64" 
 + D1."pmUlTrafficVolumePs8" 
 + D1."pmUlTrafficVolumePsCommon" 
 + D1."pmUlTrafficVolumePsIntEul" 
 + D1."pmUlTrafficVolumePsIntEulFach" 
 + D1."pmUlTrafficVolumePsStr128" 
 + D1."pmUlTrafficVolumePsStr16" 
 + D1."pmUlTrafficVolumePsStr32" 
 + D1."pmUlTrafficVolumeSrb136" 
 + D1."pmUlTrafficVolumeSrb34" 
 + D1."pmUlTrafficVolumeSrbOnlyEul")
 AS "DataVolumeUp", 
'3G' AS "NODE_TYPE"
FROM DC_E_RAN_UCELL_RAW D1
INNER JOIN DIM_E_RAN_RBS dim_rbs ON dim_rbs.AssociatedRncName = D1."RNC"
INNER JOIN DIM_E_RAN_UCELL dim_ucell ON dim_ucell.UCELL_NAME = D1."UtranCell" AND dim_ucell.RBS_ID = dim_rbs.RBS_NAME
WHERE D1."DATETIME_ID" >= @date AND 
D1."DATETIME_ID" < @dateDay AND
<conditions>
GROUP BY 
D1."DATETIME_ID",
D1."RNC",
D1."OSS_ID"

###############################################################################################################
Information Link Name:IL_DC_E_ENERGY_SAVING_FEATURES_GSM_DOD
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)


IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_BSS_CELL2_RAW') > 0 OR(SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_BSS_CELL3_RAW') > 0 )

SELECT * FROM (
SELECT 
	'2G' AS "ROWSTATUS", 
	'BCCH Power Savings' AS "DCRELEASE", 
	rn."RADIONODE_NAME" AS "SN", 
	D4."CELL_NAME" AS "CELLNAME", 
	D4."OSS_ID" AS "OSSID", 
	D4."DATETIME_ID" AS "DATETIMEID",
	(D4."CLBCCHPS_BCCHPSPCP1")/900 AS "CLBCCHPSBCCHPSPCP1",
	(D4."CLBCCHPS_BCCHPSPCP2")/900 AS "CLBCCHPSBCCHPSPCP2",
	(D4."CLBCCHPS_BCCHPSPCP3")/900 AS "CLBCCHPSBCCHPSPCP3"
FROM DC_E_BSS_CELL2_RAW D4
	INNER JOIN DIM_E_GRAN_RADIONODE_TRX trx ON D4."CELL_NAME" = trx."GSMSECTOR"
	INNER JOIN DIM_E_GRAN_RADIONODE rn ON trx."RADIONODE" = rn."RADIONODE_NAME"
	WHERE D4."DATETIME_ID" >= @date AND D4."DATETIME_ID" < @dateDay 
	AND D4."ROWSTATUS" NOT IN ('DUPLICATE','SUSPECTED')	

UNION

SELECT
	'2G' AS "ROWSTATUS", 
	'Micro SleepTx GSM' AS "DCRELEASE", 
	D2."BTS" AS "SN", 
	D2."GsmSector" AS "CELLNAME", 
	D2."OSS_ID" AS "OSSID", 
	D2."DATETIME_ID" AS "DATETIMEID",
	(D2."pmMicroTxSleepGsmTime")/900 AS "CLBCCHPSBCCHPSPCP1",
	null AS "CLBCCHPSBCCHPSPCP2",
	null AS "CLBCCHPSBCCHPSPCP3"
FROM DC_E_BTSG2_GSMSECTOR_RAW D2
	WHERE D2."DATETIME_ID" >= @date AND D2."DATETIME_ID" < @dateDay 
	AND D2."ROWSTATUS" NOT IN ('DUPLICATE','SUSPECTED')
	
UNION

SELECT 
	'2G' AS ROWSTATUS, 
	'MCPA Tx Power' AS "DCRELEASE", 
	rn.RADIONODE_NAME AS "SN", 
	D3."CELL_NAME" AS "CELLNAME", 
	D3."OSS_ID" AS "OSSID", 
	D3."DATETIME_ID" AS "DATETIMEID",
	(D3."CELLBTSPS_MCPAON") AS "CLBCCHPSBCCHPSPCP1", 
	null as "CLBCCHPSBCCHPSPCP2", 
	null as "CLBCCHPSBCCHPSPCP3"
FROM DC_E_BSS_CELL3_RAW D3
	INNER JOIN DIM_E_GRAN_RADIONODE_TRX trx ON D3."CELL_NAME" = trx."GSMSECTOR"
	INNER JOIN DIM_E_GRAN_RADIONODE rn ON trx."RADIONODE" = rn."RADIONODE_NAME"
	WHERE D3."DATETIME_ID" >= @date and D3."DATETIME_ID" < @dateDay
	AND D3."ROWSTATUS" NOT IN ('DUPLICATE','SUSPECTED')
) D1
WHERE 
<conditions>

###############################################################################################################
Information Link Name:IL_DC_E_ENERGY_SAVING_FEATURES_LTE_DOD
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_ERBS_EUTRANCELLFDD_RAW') > 0 OR (SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_ERBS_EUTRANCELLTDD_RAW') > 0) 

SELECT * FROM (

SELECT
   D4."ROWSTATUS" AS "ROWSTATUS",
   CASE
        WHEN FEATURE_NAME = null THEN '4G Energy Saving'
        WHEN FEATURE_NAME!= null THEN FEATURE_NAME
    END AS "DCRELEASE",
   D4."ERBS" AS "ERBS",
   D4."EUtranCellFDD" AS "EUTRANCELLFDD",
   D4."OSS_ID" AS "OSSID",
   D4."DATETIME_ID" AS "DATETIMEID",
   D4."pmPdschBlankedSubframe" AS "PMPDSCHBLANKEDSUBFRAME",
   D4."pmMimoSleepTime" AS "PMMIMOSLEEPTIME",
   D4."pmCellSleepTime" AS "PMCELLSLEEPTIME"
FROM
    (
      SELECT
		'4G' AS ROWSTATUS,
        ERBS,          
        EUtranCellFDD,        
		OSS_ID,      
        DATETIME_ID,
        DATE_ID,
        (pmPdschBlankedSubframe) AS pmPdschBlankedSubframe, 
        (pmMimoSleepTime)/900 AS pmMimoSleepTime, 
        (pmCellSleepTime)/900 AS pmCellSleepTime
        FROM
            DC_E_ERBS_EUTRANCELLFDD_RAW 
        WHERE
            DATETIME_ID >= @date
        AND DATETIME_ID < @dateDay
        AND ROWSTATUS NOT IN ('DUPLICATE', 'SUSPECTED')
        
        UNION
        
        SELECT
            '4G' AS ROWSTATUS,
            ERBS,
            EUtranCellTDD AS EUtranCellFDD,
            OSS_ID,
            DATETIME_ID,
            DATE_ID,
            (pmPdschBlankedSubframe) AS pmPdschBlankedSubframe, 
			(pmMimoSleepTime)/900 AS pmMimoSleepTime, 
			(pmCellSleepTime)/900 AS pmCellSleepTime
        FROM
            DC_E_ERBS_EUTRANCELLTDD_RAW
        WHERE
            DATETIME_ID >= @date
        AND DATETIME_ID < @dateDay
        AND ROWSTATUS NOT IN ('DUPLICATE', 'SUSPECTED')) D4
left JOIN
    (
        SELECT
            DATE_ID,
            element,
            CASE
                WHEN FEATURE_COUNT = 2
                THEN 'LTE AI MIMO Sleep'
                WHEN FEATURE_COUNT = 1
                THEN 'MIMO Sleep'
            END AS "FEATURE_NAME"
        FROM
            (
                SELECT
                    DATE_ID,
                    element,
                    COUNT(FEATURE_NAME) AS FEATURE_COUNT
                FROM
                    (
                        SELECT
                            FS.ELEMENT AS "ELEMENT",
                            FK.NAME    AS "FEATURE_NAME",
                            FS.DATE_ID AS "DATE_ID"
                        FROM
                            DC_E_BULK_CM_FEATUREKEY_RAW FK,
                            DC_E_BULK_CM_FEATURESTATE_RAW FS
                        WHERE
                            FK.KEYID = FS.KEYID
                        AND FS.ELEMENT = FK.ELEMENT
                        AND FS.DATE_ID = FK.DATE_ID
                        AND FS.DATE_ID >= @date
                        AND FS.DATE_ID < @dateDay
                        AND FK.NAME IN ('LteAiPoweredMimoSleepMode', 'MIMOSleepMode')
                        AND FS.FEATURESTATE = 1
                        AND FS.LICENSESTATE = 1
                        AND FS.SERVICESTATE = 1) A
                GROUP BY
                    DATE_ID,
                    element ) B ) D2
ON
    D4.DATE_ID = D2.DATE_ID
AND D4.ERBS = D2.element

UNION

SELECT 
	'4G' AS "ROWSTATUS", 
	'Micro Sleep Tx' AS "DCRELEASE", 
	D3."ERBS" AS "ERBS", 
	D3."SECTORCARRIER" AS "EUTRANCELLFDD", 
	D3."OSS_ID" AS "OSSID", 
	D3."DATETIME_ID" AS "DATETIMEID",
	(D3."pmMicroTxSleepTime")/900 AS "PMPDSCHBLANKEDSUBFRAME", 
	null AS "PMMIMOSLEEPTIME", 
	null AS "PMCELLSLEEPTIME"
FROM 
	DC_E_ERBS_SECTORCARRIER_RAW D3
WHERE 
	D3."DATETIME_ID" >= @date AND 
	D3."DATETIME_ID" < @dateDay 
	AND ROWSTATUS NOT IN ('DUPLICATE','SUSPECTED') 
) D1
WHERE
<conditions>
###############################################################################################################
Information Link Name:IL_DC_E_ENERGY_SAVING_FEATURES_NR_DOD
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)
 
IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_NR_NRCELLDU_RAW') > 0 )
SELECT
   '5G' AS "ROWSTATUS",
   'NR Service-Adaptive DRX' AS "DCRELEASE",
   D1."NR_NAME" AS "NRNAME",
   D1."NRCellDU" AS "NRCELLDU",
   D1."OSS_ID" AS "OSSID",
   D1."DATETIME_ID" AS "DATETIMEID",
   (D1."pmDrxSleepTime" / D1."pmDrxTotalTime") AS "PMDRXTOTALTIME"
FROM
   "DC_E_NR_NRCELLDU_RAW" D1
WHERE
    D1."DATETIME_ID" >= @date AND D1."DATETIME_ID" < @dateDay AND
    D1."ROWSTATUS" NOT IN ('DUPLICATE','SUSPECTED') AND
<conditions>
###############################################################################################################
Information Link Name:IL_DC_E_ENERGY_SAVING_FEATURES_WCDMA_DOD
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

 IF(SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DC_E_RAN_UCELL_RAW') > 0  

SELECT 
	'3G' AS "ROWSTATUS", 
	D1."DC_RELEASE" AS "DCRELEASE",
	D1."RNC" AS "RNC",
	D1."UtranCell" AS "UTRANCELL",
	D1."OSS_ID" AS "OSSID",
	D1."DATETIME_ID" AS "DATETIMEID",
	(D1."pmcellDownTimeTps")/900 AS "PMCELLDOWNTIMETPS"
FROM DC_E_RAN_UCELL_RAW D1
INNER JOIN DIM_E_RAN_RBS dim_rbs ON AssociatedRncName = D1."RNC"
INNER JOIN DIM_E_RAN_UCELL dim_ucell ON dim_ucell.UCELL_NAME = D1.UtranCell AND dim_ucell.RBS_ID = dim_rbs.RBS_NAME
WHERE 
	D1."DATETIME_ID" >= @date AND D1."DATETIME_ID" < @dateDay 
	AND ROWSTATUS NOT IN ('DUPLICATE','SUSPECTED') 
	AND <conditions>
###############################################################################################################
Information Link Name:IL_DC_E_TCU_CONSUMEDENERGYMEASUREMENT_DAY_DOD
DECLARE @date DATE
SET @date = dateadd(mm, -6, getdate())
DECLARE @dateDay DATE
SET @dateDay = CAST(getdate() AS DATE)

DECLARE @nodes varchar(50)
IF(SELECT count(*) FROM sys.sysviews WHERE viewname = 'DIM_E_LTE_NR') > 0
SET @nodes = @nodes + 'NR'
IF(SELECT count(*) FROM sys.sysviews WHERE viewname = 'DIM_E_LTE_ERBS') > 0
SET @nodes = @nodes + 'LTE'
IF(SELECT count(*) FROM sys.sysviews WHERE viewname = 'DIM_E_RAN_RBS') > 0 
SET @nodes = @nodes + 'WCDMA' 
IF(SELECT count(*) FROM sys.sysviews WHERE viewname = 'DIM_E_GRAN_RADIONODE') > 0
SET @nodes = @nodes + 'GSM'

IF(@nodes  = 'NRLTEWCDMAGSM')
SELECT 
D1."NE_NAME" AS "NODE",
ENERGY_NODES."NODETYPE" AS "NODETYPE",
D1."MOID" AS "MOID",
D1."OSSID" AS "OSSID",
D1."DATE_ID" AS "DATE_ID",
D1."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED",
D1."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY"
FROM
(
SELECT 
D5."NR_NAME" AS "NODE",
'5G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_NR" D5

UNION
SELECT 
D5."ERBS_NAME" AS "NODE",
'4G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_ERBS" D5

UNION
SELECT
D6."RBS_NAME" AS "NODE",
'3G' AS "NODETYPE",
D6."OSS_ID" AS "OSSID"
FROM "DIM_E_RAN_RBS" D6

UNION
SELECT
D7."RADIONODE_NAME" AS "NODE",
'2G' AS "NODETYPE",
D7."OSS_ID" AS "OSSID"
FROM "DIM_E_GRAN_RADIONODE" D7

)ENERGY_NODES,
(
SELECT
D3."NE_NAME" AS "NE_NAME",
D3."MOID" AS "MOID",
D3."OSS_ID" AS "OSSID",
D3."DATE_ID" AS "DATE_ID",
D3."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY",
D3."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D3
WHERE D3."ROWSTATUS" NOT IN ('DUPLICATE','SUSPECTED') AND D3."NE_NAME" <> '' AND D3."NE_NAME" IS NOT NULL
AND D3."DATE_ID" >= @date
)D1 
WHERE ENERGY_NODES."NODE" = D1."NE_NAME" AND D1."DATE_ID" >= @date
AND <conditions>

ELSE IF(@nodes  = 'NRLTEWCDMA')
SELECT 
D1."NE_NAME" AS "NODE",
ENERGY_NODES."NODETYPE" AS "NODETYPE",
D1."MOID" AS "MOID",
D1."OSSID" AS "OSSID",
D1."DATETIMEID" AS "DATETIMEID",
D1."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED",
D1."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY"
FROM
(
SELECT 
D5."NR_NAME" AS "NODE",
'5G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_NR" D5

UNION
SELECT 
D5."ERBS_NAME" AS "NODE",
'4G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_ERBS" D5

UNION
SELECT
D6."RBS_NAME" AS "NODE",
'3G' AS "NODETYPE",
D6."OSS_ID" AS "OSSID"
FROM "DIM_E_RAN_RBS" D6

)ENERGY_NODES,
(
SELECT
D3."NE_NAME" AS "NE_NAME",
D3."MOID" AS "MOID",
D3."OSS_ID" AS "OSSID",
D3."DATE_ID" AS "DATE_ID",
D3."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY",
D3."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D3
WHERE
D3."ROWSTATUS" NOT IN ('DUPLICATE','SUSPECTED') AND D3."NE_NAME" <> '' AND D3."NE_NAME" IS NOT NULL AND D2."DATE_ID" >= @date
)D1 
WHERE ENERGY_NODES."NODE" = D1."NE_NAME" AND D2."DATETIMEID" >= @date AND <conditions>


ELSE IF(@nodes  = 'NRLTEGSM')
SELECT 
D1."NE_NAME" AS "NODE",
ENERGY_NODES."NODETYPE" AS "NODETYPE",
D1."MOID" AS "MOID",
D1."OSSID" AS "OSSID",
D1."DATE_ID" AS "DATE_ID",
D1."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED",
D1."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY"
FROM
(
SELECT 
D5."NR_NAME" AS "NODE",
'5G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_NR" D5

UNION
SELECT 
D5."ERBS_NAME" AS "NODE",
'4G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_ERBS" D5

UNION
SELECT
D7."RADIONODE_NAME" AS "NODE",
'2G' AS "NODETYPE",
D7."OSS_ID" AS "OSSID"
FROM "DIM_E_GRAN_RADIONODE" D7

)ENERGY_NODES,
(
SELECT
D3."NE_NAME" AS "NE_NAME",
D3."MOID" AS "MOID",
D3."OSS_ID" AS "OSSID",
D3."DATE_ID" AS "DATETIMEID",
D3."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY",
D3."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D3
WHERE
D3."ROWSTATUS" NOT IN ('DUPLICATE','SUSPECTED') AND D3."NE_NAME" <> '' AND D3."NE_NAME" IS NOT NULL AND D3."DATE_ID" >= @date
)D1 
WHERE ENERGY_NODES."NODE" = D1."NE_NAME" AND D1."DATE_ID" >= @date AND <conditions>


ELSE IF(@nodes  = 'NRWCDMAGSM')
SELECT 
D1."NE_NAME" AS "NODE",
ENERGY_NODES."NODETYPE" AS "NODETYPE",
D1."MOID" AS "MOID",
D1."OSSID" AS "OSSID",
D1."DATE_ID" AS "DATE_ID",
D1."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED",
D1."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY"
FROM
(
SELECT 
D5."NR_NAME" AS "NODE",
'5G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_NR" D5

UNION
SELECT
D6."RBS_NAME" AS "NODE",
'3G' AS "NODETYPE",
D6."OSS_ID" AS "OSSID"
FROM "DIM_E_RAN_RBS" D6

UNION
SELECT
D7."RADIONODE_NAME" AS "NODE",
'2G' AS "NODETYPE",
D7."OSS_ID" AS "OSSID"
FROM "DIM_E_GRAN_RADIONODE" D7

)ENERGY_NODES,
(
SELECT
D3."NE_NAME" AS "NE_NAME",
D3."MOID" AS "MOID",
D3."OSS_ID" AS "OSSID",
D3."DATE_ID" AS "DATE_ID",
D3."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY",
D3."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D3
WHERE
D3."ROWSTATUS" NOT IN ('DUPLICATE','SUSPECTED') AND D3."NE_NAME" <> '' AND D3."NE_NAME" IS NOT NULL AND D3."DATE_ID" >= @date
)D1 
WHERE ENERGY_NODES."NODE" = D1."NE_NAME" AND D1."DATE_ID" >= @date AND <conditions>


ELSE IF(@nodes  = 'NRLTE')
SELECT 
D1."NE_NAME" AS "NODE",
ENERGY_NODES."NODETYPE" AS "NODETYPE",
D1."MOID" AS "MOID",
D1."OSSID" AS "OSSID",
D1."DATE_ID" AS "DATE_ID",
D1."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED",
D1."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY"
FROM
(
SELECT 
D5."NR_NAME" AS "NODE",
'5G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_NR" D5

UNION
SELECT 
D5."ERBS_NAME" AS "NODE",
'4G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_ERBS" D5

)ENERGY_NODES,
(
SELECT
D3."NE_NAME" AS "NE_NAME",
D3."MOID" AS "MOID",
D3."OSS_ID" AS "OSSID",
D3."DATE_ID" AS "DATE_ID",
D3."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY",
D3."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D3
WHERE
D3."ROWSTATUS" NOT IN ('DUPLICATE','SUSPECTED') AND D3."NE_NAME" <> '' AND D3."NE_NAME" IS NOT NULL AND D3."DATE_ID" >= @date
)D1 
WHERE ENERGY_NODES."NODE" = D1."NE_NAME" AND D1."DATE_ID" >= @date AND <conditions>


ELSE IF(@nodes  = 'NRWCDMA')
SELECT 
D1."NE_NAME" AS "NODE",
ENERGY_NODES."NODETYPE" AS "NODETYPE",
D1."MOID" AS "MOID",
D1."OSSID" AS "OSSID",
D1."DATE_ID" AS "DATE_ID",
D1."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED",
D1."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY"
FROM
(
SELECT 
D5."NR_NAME" AS "NODE",
'5G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_NR" D5

UNION
SELECT
D6."RBS_NAME" AS "NODE",
'3G' AS "NODETYPE",
D6."OSS_ID" AS "OSSID"
FROM "DIM_E_RAN_RBS" D6

)ENERGY_NODES,
(
SELECT
D3."NE_NAME" AS "NE_NAME",
D3."MOID" AS "MOID",
D3."OSS_ID" AS "OSSID",
D3."DATE_ID" AS "DATE_ID",
D3."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY",
D3."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_RAW" D3
WHERE
D3."ROWSTATUS" NOT IN ('DUPLICATE','SUSPECTED') AND D3."NE_NAME" <> '' AND D3."NE_NAME" IS NOT NULL AND D3."DATE_ID" >= @date
)D1 
WHERE ENERGY_NODES."NODE" = D1."NE_NAME" AND D1."DATE_ID" >= @date AND <conditions>


ELSE IF(@nodes  = 'NRGSM')
SELECT 
D1."NE_NAME" AS "NODE",
ENERGY_NODES."NODETYPE" AS "NODETYPE",
D1."MOID" AS "MOID",
D1."OSSID" AS "OSSID",
D1."DATE_ID" AS "DATE_ID",
D1."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED",
D1."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY"
FROM
(
SELECT 
D5."NR_NAME" AS "NODE",
'5G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_NR" D5

UNION
SELECT
D7."RADIONODE_NAME" AS "NODE",
'2G' AS "NODETYPE",
D7."OSS_ID" AS "OSSID"
FROM "DIM_E_GRAN_RADIONODE" D7

)ENERGY_NODES,
(
SELECT
D3."NE_NAME" AS "NE_NAME",
D3."MOID" AS "MOID",
D3."OSS_ID" AS "OSSID",
D3."DATE_ID" AS "DATE_ID",
D3."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY",
D3."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D3
WHERE
D3."ROWSTATUS" NOT IN ('DUPLICATE','SUSPECTED') AND D3."NE_NAME" <> '' AND D3."NE_NAME" IS NOT NULL AND D3."DATE_ID" >= @date
)D1 
WHERE ENERGY_NODES."NODE" = D1."NE_NAME" AND D1."DATE_ID" >= @date AND <conditions>


ELSE IF(@nodes  = 'NR')
SELECT 
D1."NE_NAME" AS "NODE",
ENERGY_NODES."NODETYPE" AS "NODETYPE",
D1."MOID" AS "MOID",
D1."OSSID" AS "OSSID",
D1."DATE_ID" AS "DATE_ID",
D1."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED",
D1."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY"
FROM
(
SELECT 
D5."NR_NAME" AS "NODE",
'5G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_NR" D5

)ENERGY_NODES,
(
SELECT
D3."NE_NAME" AS "NE_NAME",
D3."MOID" AS "MOID",
D3."OSS_ID" AS "OSSID",
D3."DATE_ID" AS "DATE_ID",
D3."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY",
D3."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D3
WHERE
D3."DATE_ID" >= @date AND D3."DATE_ID" < @dateDay 
AND D3."ROWSTATUS" NOT IN ('DUPLICATE','SUSPECTED') AND D3."NE_NAME" <> '' AND D3."NE_NAME" IS NOT NULL AND D3."DATE_ID" >= @date
)D1 
WHERE ENERGY_NODES."NODE" = D1."NE_NAME" AND D1."DATE_ID" >= @date AND <conditions>


ELSE IF(@nodes  = 'LTEWCDMAGSM')
SELECT 
D1."NE_NAME" AS "NODE",
ENERGY_NODES."NODETYPE" AS "NODETYPE",
D1."MOID" AS "MOID",
D1."OSSID" AS "OSSID",
D1."DATE_ID" AS "DATE_ID",
D1."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED",
D1."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY"
FROM
(
SELECT 
D5."ERBS_NAME" AS "NODE",
'4G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_ERBS" D5

UNION
SELECT
D6."RBS_NAME" AS "NODE",
'3G' AS "NODETYPE",
D6."OSS_ID" AS "OSSID"
FROM "DIM_E_RAN_RBS" D6

UNION
SELECT
D7."RADIONODE_NAME" AS "NODE",
'2G' AS "NODETYPE",
D7."OSS_ID" AS "OSSID"
FROM "DIM_E_GRAN_RADIONODE" D7

)ENERGY_NODES,
(
SELECT
D3."NE_NAME" AS "NE_NAME",
D3."MOID" AS "MOID",
D3."OSS_ID" AS "OSSID",
D3."DATE_ID" AS "DATE_ID",
D3."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY",
D3."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D3
WHERE
D3."ROWSTATUS" NOT IN ('DUPLICATE','SUSPECTED') AND D3."NE_NAME" <> '' AND D3."NE_NAME" IS NOT NULL AND D3."DATE_ID" >= @date
)D1 
WHERE ENERGY_NODES."NODE" = D1."NE_NAME" AND D1."DATE_ID" >= @date AND <conditions>


ELSE IF(@nodes  = 'LTEWCDMA')
SELECT 
D1."NE_NAME" AS "NODE",
ENERGY_NODES."NODETYPE" AS "NODETYPE",
D1."MOID" AS "MOID",
D1."OSSID" AS "OSSID",
D1."DATE_ID" AS "DATE_ID",
D1."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED",
D1."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY"
FROM
(
SELECT 
D5."ERBS_NAME" AS "NODE",
'4G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_ERBS" D5

UNION
SELECT
D6."RBS_NAME" AS "NODE",
'3G' AS "NODETYPE",
D6."OSS_ID" AS "OSSID"
FROM "DIM_E_RAN_RBS" D6

)ENERGY_NODES,
(
SELECT
D3."NE_NAME" AS "NE_NAME",
D3."MOID" AS "MOID",
D3."OSS_ID" AS "OSSID",
D3."DATE_ID" AS "DATE_ID",
D3."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY",
D3."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D3
WHERE
D3."ROWSTATUS" NOT IN ('DUPLICATE','SUSPECTED') AND D3."NE_NAME" <> '' AND D3."NE_NAME" IS NOT NULL AND D3."DATE_ID" >= @date
)D1 
WHERE ENERGY_NODES."NODE" = D1."NE_NAME" AND D1."DATE_ID" >= @date AND <conditions>


ELSE IF(@nodes  = 'LTEGSM')
SELECT 
D1."NE_NAME" AS "NODE",
ENERGY_NODES."NODETYPE" AS "NODETYPE",
D1."MOID" AS "MOID",
D1."OSSID" AS "OSSID",
D1."DATE_ID" AS "DATE_ID",
D1."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED",
D1."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY"
FROM
(
SELECT 
D5."ERBS_NAME" AS "NODE",
'4G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_ERBS" D5

UNION
SELECT
D7."RADIONODE_NAME" AS "NODE",
'2G' AS "NODETYPE",
D7."OSS_ID" AS "OSSID"
FROM "DIM_E_GRAN_RADIONODE" D7

)ENERGY_NODES,
(
SELECT
D3."NE_NAME" AS "NE_NAME",
D3."MOID" AS "MOID",
D3."OSS_ID" AS "OSSID",
D3."DATE_ID" AS "DATE_ID",
D3."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY",
D3."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D3
WHERE
D3."ROWSTATUS" NOT IN ('DUPLICATE','SUSPECTED') AND D3."NE_NAME" <> '' AND D3."NE_NAME" IS NOT NULL AND D3."DATE_ID" >= @date
)D1 
WHERE ENERGY_NODES."NODE" = D1."NE_NAME" AND D1."DATE_ID" >= @date AND <conditions>


ELSE IF(@nodes  = 'WCDMAGSM')
SELECT 
D1."NE_NAME" AS "NODE",
ENERGY_NODES."NODETYPE" AS "NODETYPE",
D1."MOID" AS "MOID",
D1."OSSID" AS "OSSID",
D1."DATE_ID" AS "DATE_ID",
D1."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED",
D1."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY"
FROM
(
SELECT
D6."RBS_NAME" AS "NODE",
'3G' AS "NODETYPE",
D6."OSS_ID" AS "OSSID"
FROM "DIM_E_RAN_RBS" D6

UNION
SELECT
D7."RADIONODE_NAME" AS "NODE",
'2G' AS "NODETYPE",
D7."OSS_ID" AS "OSSID"
FROM "DIM_E_GRAN_RADIONODE" D7

)ENERGY_NODES,
(
SELECT
D3."NE_NAME" AS "NE_NAME",
D3."MOID" AS "MOID",
D3."OSS_ID" AS "OSSID",
D3."DATE_ID" AS "DATE_ID",
D3."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY",
D3."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D3
WHERE
D3."ROWSTATUS" NOT IN ('DUPLICATE','SUSPECTED') AND D3."NE_NAME" <> '' AND D3."NE_NAME" IS NOT NULL AND D3."DATE_ID" >= @date
)D1 
WHERE ENERGY_NODES."NODE" = D1."NE_NAME" AND D1."DATE_ID" >= @date AND <conditions>


ELSE IF(@nodes  = 'LTE')
SELECT 
D1."NE_NAME" AS "NODE",
ENERGY_NODES."NODETYPE" AS "NODETYPE",
D1."MOID" AS "MOID",
D1."OSSID" AS "OSSID",
D1."DATE_ID" AS "DATE_ID",
D1."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED",
D1."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY"
FROM
(
SELECT 
D5."ERBS_NAME" AS "NODE",
'4G' AS "NODETYPE",
D5."OSS_ID" AS "OSSID"
FROM "DIM_E_LTE_ERBS" D5

)ENERGY_NODES,
(
SELECT
D3."NE_NAME" AS "NE_NAME",
D3."MOID" AS "MOID",
D3."OSS_ID" AS "OSSID",
D3."DATE_ID" AS "DATE_ID",
D3."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY",
D3."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D3
WHERE
D3."ROWSTATUS" NOT IN ('DUPLICATE','SUSPECTED') AND D3."NE_NAME" <> '' AND D3."NE_NAME" IS NOT NULL AND D3."DATE_ID" >= @date
)D1 
WHERE ENERGY_NODES."NODE" = D1."NE_NAME" AND D1."DATE_ID" >= @date AND <conditions>


ELSE IF(@nodes  = 'WCDMA')
SELECT 
D1."NE_NAME" AS "NODE",
ENERGY_NODES."NODETYPE" AS "NODETYPE",
D1."MOID" AS "MOID",
D1."OSSID" AS "OSSID",
D1."DATETIMEID" AS "DATETIMEID",
D1."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED",
D1."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY"
FROM
(
SELECT
D6."RBS_NAME" AS "NODE",
'3G' AS "NODETYPE",
D6."OSS_ID" AS "OSSID"
FROM "DIM_E_RAN_RBS" D6

)ENERGY_NODES,
(
SELECT
D3."NE_NAME" AS "NE_NAME",
D3."MOID" AS "MOID",
D3."OSS_ID" AS "OSSID",
D3."DATE_ID" AS "DATE_ID",
D3."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY",
D3."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D3
WHERE
D3."ROWSTATUS" NOT IN ('DUPLICATE','SUSPECTED') AND D3."NE_NAME" <> '' AND D3."NE_NAME" IS NOT NULL AND D3."DATE_ID" >= @date
)D1 
WHERE ENERGY_NODES."NODE" = D1."NE_NAME"  AND D1."DATE_ID" >= @date AND <conditions>


ELSE IF(@nodes  = 'GSM')
SELECT 
D1."NE_NAME" AS "NODE",
ENERGY_NODES."NODETYPE" AS "NODETYPE",
D1."MOID" AS "MOID",
D1."OSSID" AS "OSSID",
D1."DATE_ID" AS "DATE_ID",
D1."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED",
D1."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY"
FROM
(
SELECT
D7."RADIONODE_NAME" AS "NODE",
'2G' AS "NODETYPE",
D7."OSS_ID" AS "OSSID"
FROM "DIM_E_GRAN_RADIONODE" D7

)ENERGY_NODES,
(
SELECT
D3."NE_NAME" AS "NE_NAME",
D3."MOID" AS "MOID",
D3."OSS_ID" AS "OSSID",
D3."DATE_ID" AS "DATE_ID",
D3."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY",
D3."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED"
FROM
"DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D3
WHERE 
D3."ROWSTATUS" NOT IN ('DUPLICATE','SUSPECTED') AND D3."NE_NAME" <> '' AND D3."NE_NAME" IS NOT NULL AND D3."DATE_ID" >= @date
)D1 
WHERE ENERGY_NODES."NODE" = D1."NE_NAME" AND D1."DATE_ID" >= @date
AND <conditions>

###############################################################################################################
Information Link Name:IL_DC_E_TCU_CONSUMEDENERGYMEASUREMENT_GSM_DAY
DECLARE @date DATE
SET @date = DATEADD(mm, -6, GETDATE())
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)
IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DIM_E_GRAN_RADIONODE') > 0 )
SELECT
	'2G' AS "ROWSTATUS",
	D1."DATE_ID" AS "DATEID",
                D1."NE_NAME" AS "NENAME",
               SUM(D1."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGY",
    SUM(D1."PMCONSUMEDENERGYACCUMULATED") AS "PMCONSUMEDENERGYACCUMULATED"
FROM
    "DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D1
WHERE
    D1."DATE_ID" >= @date
    AND D1."DATE_ID" < @dateDay
    AND D1."ROWSTATUS" NOT IN ('DUPLICATE', 'SUSPECTED')
    AND D1."NE_NAME" <> ''
    AND D1."NE_NAME" IS NOT NULL
    AND D1."NE_NAME" in (
    SELECT
        D5."RADIONODE_NAME" AS "NODE"
    FROM
        "DIM_E_GRAN_RADIONODE" D5)
    GROUP BY 
	D1."DATE_ID",
                D1."NE_NAME"              
ELSE
SELECT
	NULL AS "NODE_TYPE",
	NULL AS "DATE_ID", 
 	NULL AS "PMCONSUMEDENERGY", 
 	NULL AS "PMCONSUMEDENERGYACCUMULATED" 
###############################################################################################################
Information Link Name:IL_DC_E_TCU_CONSUMEDENERGYMEASUREMENT_GSM_EU_DAY
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DIM_E_GRAN_RADIONODE') > 0 )
SELECT
D1."DATE_ID" AS "DATEID",
   D1."OSS_ID" AS "OSSID",
   D1."NE_NAME" AS "NENAME",
   D1."MOID" AS "MOID",
    '2G' AS "NODETYPE",
    SUM(D1."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGY",
    SUM(D1."PMCONSUMEDENERGYACCUMULATED") AS "PMCONSUMEDENERGYACCUMULATED"
FROM
    "DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D1
WHERE
    D1."DATE_ID" >= @date
    AND D1."DATE_ID" < @dateDay
    AND D1."ROWSTATUS" NOT IN ('DUPLICATE', 'SUSPECTED')
    AND D1."NE_NAME" <> ''
    AND D1."NE_NAME" IS NOT NULL
    AND D1."NE_NAME" in (
    SELECT
        D5."RADIONODE_NAME" AS "NODE"
    FROM
        "DIM_E_GRAN_RADIONODE" D5)
    GROUP BY 
D1."OSS_ID",
D1."NE_NAME",
D1."MOID",
D1."DATE_ID"
###############################################################################################################
Information Link Name:IL_DC_E_TCU_CONSUMEDENERGYMEASUREMENT_LTE_DAY
DECLARE @date DATE
SET @date = DATEADD(mm, -6, GETDATE())
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)
IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DIM_E_LTE_ERBS') > 0 )
SELECT
	'4G' AS "ROWSTATUS",
	D1."DATE_ID" AS "DATEID",
                D1."NE_NAME" AS "NENAME",
     SUM(D1."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGY",
    SUM(D1."PMCONSUMEDENERGYACCUMULATED") AS "PMCONSUMEDENERGYACCUMULATED"
FROM
    "DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D1
WHERE
    D1."DATE_ID" >= @date
    AND D1."DATE_ID" < @dateDay
    AND D1."ROWSTATUS" NOT IN ('DUPLICATE', 'SUSPECTED')
    AND D1."NE_NAME" <> ''
    AND D1."NE_NAME" IS NOT NULL
    AND D1."NE_NAME" in (
    SELECT
        D5."ERBS_NAME" AS "NODE"
    FROM
        "DIM_E_LTE_ERBS" D5)
    GROUP BY 
	D1."DATE_ID",
                D1."NE_NAME"          
	
ELSE
SELECT
	NULL AS "NODE_TYPE",
	NULL AS "DATE_ID", 
 	NULL AS "PMCONSUMEDENERGY", 
 	NULL AS "PMCONSUMEDENERGYACCUMULATED" 
###############################################################################################################
Information Link Name:IL_DC_E_TCU_CONSUMEDENERGYMEASUREMENT_LTE_EU_DAY
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DIM_E_LTE_ERBS') > 0 )
SELECT
   D1."DATE_ID" AS "DATEID",
   D1."OSS_ID" AS "OSSID",
   D1."NE_NAME" AS "NENAME",
   D1."MOID" AS "MOID",
    '4G' AS "NODETYPE",
    SUM(D1."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGY",
    SUM(D1."PMCONSUMEDENERGYACCUMULATED") AS "PMCONSUMEDENERGYACCUMULATED"
FROM
    "DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D1
WHERE
    D1."DATE_ID" >= @date
    AND D1."DATE_ID" < @dateDay
    AND D1."ROWSTATUS" NOT IN ('DUPLICATE', 'SUSPECTED')
    AND D1."NE_NAME" <> ''
    AND D1."NE_NAME" IS NOT NULL
    AND D1."NE_NAME" in (
    SELECT
        D5."ERBS_NAME" AS "NODE"
    FROM
        "DIM_E_LTE_ERBS" D5)
    GROUP BY 
D1."OSS_ID",
D1."NE_NAME",
D1."MOID",
D1."DATE_ID"
###############################################################################################################
Information Link Name:IL_DC_E_TCU_CONSUMEDENERGYMEASUREMENT_NR_DAY
DECLARE @date DATE
SET @date = DATEADD(mm, -6, GETDATE())
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)
IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DIM_E_LTE_NR') > 0 )
SELECT
    '5G' AS "ROWSTATUS",
    D1."DATE_ID" AS "DATEID",
    D1."NE_NAME" AS "NENAME",
    SUM(D1."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGY",
    SUM(D1."PMCONSUMEDENERGYACCUMULATED") AS "PMCONSUMEDENERGYACCUMULATED"
FROM
    "DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_day" D1
WHERE
    D1."DATE_ID" >= @date
    AND D1."DATE_ID" < @dateDay
    AND D1."ROWSTATUS" NOT IN ('DUPLICATE', 'SUSPECTED')
    AND D1."NE_NAME" <> ''
    AND D1."NE_NAME" IS NOT NULL
    AND D1."NE_NAME" in (
    SELECT
        D5."NR_NAME" AS "NODE"
    FROM
        "DIM_E_LTE_NR" D5)
    GROUP BY 
	D1."DATE_ID",
                D1."NE_NAME"            
	
ELSE
SELECT
	NULL AS "NODE_TYPE",
	NULL AS "DATE_ID", 
 	NULL AS "PMCONSUMEDENERGY", 
 	NULL AS "PMCONSUMEDENERGYACCUMULATED" 
###############################################################################################################
Information Link Name:IL_DC_E_TCU_CONSUMEDENERGYMEASUREMENT_NR_EU_DAY
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DIM_E_LTE_NR') > 0 )
SELECT
   D1."DATE_ID" AS "DATEID",
   D1."OSS_ID" AS "OSSID",
   D1."NE_NAME" AS "NENAME",
   D1."MOID" AS "MOID",
    '5G' AS "NODETYPE",
    SUM(D1."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGY",
    SUM(D1."PMCONSUMEDENERGYACCUMULATED") AS "PMCONSUMEDENERGYACCUMULATED"
FROM
    "DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D1
WHERE
    D1."DATE_ID" >= @date
    AND D1."DATE_ID" < @dateDay
    AND D1."ROWSTATUS" NOT IN ('DUPLICATE', 'SUSPECTED')
    AND D1."NE_NAME" <> ''
    AND D1."NE_NAME" IS NOT NULL
    AND D1."NE_NAME" in (
    SELECT
        D5."NR_NAME" AS "NODE"
    FROM
        "DIM_E_LTE_NR" D5)
    GROUP BY 
D1."DATE_ID",
D1."OSS_ID",
D1."NE_NAME",
D1."MOID"
###############################################################################################################
Information Link Name:IL_DC_E_TCU_CONSUMEDENERGYMEASUREMENT_RAW_DOD
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

SELECT
   D1."NE_NAME" AS "NODE",
   D1."MOID" AS "MOID",
   D1."OSS_ID" AS "OSSID",
   D1."DATETIME_ID" AS "DATETIMEID",
   D1."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY",
   D1."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED"
FROM
   "DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_RAW" D1
WHERE
   D1."DATETIME_ID" >= @date
   AND D1."DATETIME_ID" < @dateDay
   AND D1."ROWSTATUS" NOT IN ('DUPLICATE',
   'SUSPECTED')
   AND D1."NE_NAME" <> ''
   AND D1."NE_NAME" IS NOT NULL
   AND <conditions>
###############################################################################################################
Information Link Name:IL_DC_E_TCU_CONSUMEDENERGYMEASUREMENT_WCDMA_DAY
DECLARE @date DATE
SET @date = DATEADD(mm, -6, GETDATE())
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)
IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DIM_E_RAN_RBS') > 0 )
SELECT
	'3G' AS "ROWSTATUS",
	D1."DATE_ID" AS "DATEID",
                D1."NE_NAME" AS "NENAME",
     SUM(D1."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGY",
    SUM(D1."PMCONSUMEDENERGYACCUMULATED") AS "PMCONSUMEDENERGYACCUMULATED"
FROM
    "DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D1
WHERE
    D1."DATE_ID" >= @date
    AND D1."DATE_ID" < @dateDay
    AND D1."ROWSTATUS" NOT IN ('DUPLICATE', 'SUSPECTED')
    AND D1."NE_NAME" <> ''
    AND D1."NE_NAME" IS NOT NULL
    AND D1."NE_NAME" in (
    SELECT
        D5."RBS_NAME" AS "NODE"
    FROM
        "DIM_E_RAN_RBS" D5)
    GROUP BY 
	D1."DATE_ID",
               D1."NE_NAME"              

ELSE
SELECT
	NULL AS "NODE_TYPE",
	NULL AS "DATE_ID", 
 	NULL AS "PMCONSUMEDENERGY", 
 	NULL AS "PMCONSUMEDENERGYACCUMULATED" 
	
###############################################################################################################
Information Link Name:IL_DC_E_TCU_CONSUMEDENERGYMEASUREMENT_WCDMA_EU_DAY
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

IF((SELECT COUNT(*) FROM SYS.SYSVIEWS WHERE VIEWNAME = 'DIM_E_RAN_RBS') > 0 )
SELECT
D1."DATE_ID" AS "DATEID",
   D1."OSS_ID" AS "OSSID",
   D1."NE_NAME" AS "NENAME",
   D1."MOID" AS "MOID",
    '3G' AS "NODETYPE",
    SUM(D1."PMCONSUMEDENERGY") AS "PMCONSUMEDENERGY",
    SUM(D1."PMCONSUMEDENERGYACCUMULATED") AS "PMCONSUMEDENERGYACCUMULATED"
FROM
    "DC_E_TCU_CONSUMEDENERGYMEASRUEMENT_DAY" D1
WHERE
    D1."DATE_ID" >= @date
    AND D1."DATE_ID" < @dateDay
    AND D1."ROWSTATUS" NOT IN ('DUPLICATE', 'SUSPECTED')
    AND D1."NE_NAME" <> ''
    AND D1."NE_NAME" IS NOT NULL
    AND D1."NE_NAME" in (
    SELECT
        D5."RBS_NAME" AS "NODE"
    FROM
        "DIM_E_RAN_RBS" D5)
    GROUP BY 
D1."OSS_ID",
D1."NE_NAME",
D1."MOID",
D1."DATE_ID"

###############################################################################################################
Information Link Name:IL_DC_E_TCU_ENERGYMETER_DAY
DECLARE @date DATE
SET @date = DATEADD(mm, -6, GETDATE())
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

SELECT
   D1."DATE_ID" AS "DATEID",
   D1."NE_NAME" AS "NENAME",
   D1."MOID" AS "MOID",
   D1."OSS_ID" AS "OSSID",
   D1."FieldReplaceableUnit" AS "FIELDREPLACEABLEUNIT",
   D1."pmConsumedEnergy" AS "PMCONSUMEDENERGY",
   D1."pmConsumedEnergyAccumulated" AS "PMCONSUMEDENERGYACCUMULATED"
FROM
   "DC_E_TCU_ENERGYMETER_DAY" D1
WHERE
    D1."DATE_ID" >= @date AND D1."DATE_ID" < @dateDay
    AND D1."ROWSTATUS" = 'AGGREGATED' 
	
###############################################################################################################
Information Link Name:IL_DC_E_TCU_ENERGYMETER_DOD
DECLARE @date DATE
SET @date = DATEADD(dd,-7,GETDATE()) 
DECLARE @dateDay DATE
SET @dateDay = CAST(GETDATE() AS DATE)

SELECT 
D1."NE_NAME" AS "NENAME",
D1."MOID" AS "MOID",
D1."OSS_ID" AS "OSSID",
D1."DATETIME_ID" AS "DATETIMEID",
D1."DATE_ID" AS "DATEID",
D1."FieldReplaceableUnit" AS "FIELDREPLACEABLEUNIT",
D1."PMCONSUMEDENERGYACCUMULATED" AS "PMCONSUMEDENERGYACCUMULATED",
D1."PMCONSUMEDENERGY" AS "PMCONSUMEDENERGY"
FROM
"DC_E_TCU_ENERGYMETER_RAW" D1
WHERE
D1."DATETIME_ID" >= @date AND D1."DATETIME_ID" < @dateDay
AND <conditions>

###############################################################################################################